// Generated by Construct, the game and animation creation tool
// Visit: https://www.construct.net

"use strict";window.i=class{constructor(t,s){this.h=t,this.o=s,this.l=!1,this.u=()=>this.m()}v(){}S(t,s,i,e){this.h._(this.o,t,s,i,e)}P(t,s,i,e){return this.h.M(this.o,t,s,i,e)}O(t,s,i){this.h.R()?this.S(t,s,i):this.h.T({type:"event",component:this.o,handler:t,dispatchOpts:i||null,data:s,responseId:null})}C(t,s){this.h.G(this.o,t,s)}I(t){for(const[s,i]of t)this.C(s,i)}A(){return this.h}D(){return this.o}F(){this.l||(this.h.L(this.u),this.l=!0)}U(){this.l&&(this.h.W(this.u),this.l=!1)}m(){}},window.H=class{constructor(t,s){this.V=t,this.B=s,this.N=-1,this.j=-1/0,this.$=()=>this.Y(),this.X=!1,this.J=!1}K(t){this.J=!!t}Z(){if(-1!==this.N)return;const t=Date.now(),s=t-this.j,i=this.B;s>=i&&this.J?(this.j=t,this.tt()):this.N=self.setTimeout(this.$,Math.max(i-s,4))}tt(){this.X=!0,this.V(),this.X=!1}st(){this.X||(this.it(),this.j=Date.now())}Y(){this.N=-1,this.j=Date.now(),this.tt()}it(){-1!==this.N&&(self.clearTimeout(this.N),this.N=-1)}et(){this.it(),this.V=null,this.$=null}};{class t{constructor(t){this.ht=t,this.nt=!1,this.ot=!0,this.rt=-1,this.ct=-1,this.lt=-1}ut(t){this.ot=!!t}dt(){return this.ot}wt(){return this.nt}ft(){this.nt=!0}gt(){return this.rt}yt(t){this.rt=t}vt(){return this.ct}bt(t){this.ct=t}St(t){this.lt=t}_t(){return this.lt}kt(){return this.ht}}window.Pt=class extends self.i{constructor(t,s){super(t,s),this.xt=new Map,this.Mt=!0,this.I([["create",t=>this.Ot(t)],["destroy",t=>this.Rt(t)],["set-visible",t=>this.Tt(t)],["update-position",t=>this.Ct(t)],["update-state",t=>this.Gt(t)],["focus",t=>this.It(t)],["set-css-style",t=>this.Et(t)],["set-attribute",t=>this.At(t)],["remove-attribute",t=>this.Dt(t)]]),this.Ft("get-element",t=>t)}Lt(t){this.Mt=!!t}Ft(t,s){this.C(t,t=>{const i=t.elementId,e=this.Ut(i);return s(e,t)})}Wt(t){for(const[s,i]of t)this.Ft(s,i)}Ot(s){const i=s.elementId,e=this.Ht(i,s),h=new t(e);this.xt.set(i,h),e.style.boxSizing="border-box",e.style.display="none",h.ut(s.isVisible);const n=this.Vt(e);n.addEventListener("focus",t=>this.Bt(i)),n.addEventListener("blur",t=>this.Nt(i));const o=s.htmlIndex;if(h.yt(o),h.St(s.htmlZIndex),this.Mt){const t=this.A().jt(o);h.bt(t),this.A().$t(t).appendChild(e)}}Ht(t,s){throw new Error("required override")}zt(t){}Rt(t){const s=t.elementId,i=this.Ut(s);this.zt(i),this.Mt&&i.parentElement.removeChild(i),this.xt.delete(s)}qt(t,s,i){i||(i={}),i.elementId=s,this.S(t,i)}Yt(t,s,i){i||(i={}),i.elementId=s,this.O(t,i)}Tt(t){if(!this.Mt)return;const s=this.xt.get(t.elementId),i=s.kt();s.wt()?i.style.display=t.isVisible?"":"none":s.ut(t.isVisible)}Ct(t){if(!this.Mt)return;const s=this.xt.get(t.elementId),i=s.kt(),e=this.A();i.style.left=t.left+"px",i.style.top=t.top+"px",i.style.width=t.width+"px",i.style.height=t.height+"px";const h=t.fontSize;null!==h&&(i.style.fontSize=h+"em");const n=t.htmlIndex;s.yt(n);const o=e.jt(n);o!==s.vt()&&(i.remove(),e.$t(o).appendChild(i),s.bt(o),e.Xt());const r=t.htmlZIndex;r!==s._t()&&(s.St(r),e.Xt()),s.wt()||(s.ft(),s.dt()&&(i.style.display=""))}Jt(){if(this.Mt)for(const t of this.xt.values()){const s=this.A().jt(t.gt()),i=t.vt();if(-1!==s&&-1!==i&&s!==i){const i=t.kt();i.remove(),this.A().$t(s).appendChild(i),t.bt(s)}}}Kt(){return this.Mt?[...this.xt.values()]:null}Gt(t){const s=this.Ut(t.elementId);this.Zt(s,t)}Zt(t,s){throw new Error("required override")}Vt(t){return t}Bt(t){this.qt("elem-focused",t)}Nt(t){this.qt("elem-blurred",t)}It(t){const s=this.Vt(this.Ut(t.elementId));t.focus?s.focus():s.blur()}Et(t){const s=this.Ut(t.elementId),i=t.prop,e=t.val;i.startsWith("--")?s.style.setProperty(i,e):s.style[i]=e}At(t){this.Ut(t.elementId).setAttribute(t.name,t.val)}Dt(t){this.Ut(t.elementId).removeAttribute(t.name)}Ut(t){const s=this.xt.get(t);if(!s)throw new Error(`no element with id ${t}`);return s.kt()}}}{const s=/(iphone|ipod|ipad|macos|macintosh|mac os x)/i.test(navigator.userAgent),i=/android/i.test(navigator.userAgent),e=/safari/i.test(navigator.userAgent)&&!/(chrome|chromium|edg\/|OPR\/)/i.test(navigator.userAgent);let h=0;function n(t){const s=document.createElement("script");return s.async=!1,s.type="module",t.Qt?new Promise(i=>{const e="c3_resolve_"+h;++h,self[e]=i,s.textContent=t.ts+`\n\nself["${e}"]();`,document.head.appendChild(s)}):new Promise((i,e)=>{s.onload=i,s.onerror=e,s.src=t,document.head.appendChild(s)})}async function o(){if(!navigator.userActivation||"undefined"==typeof OffscreenCanvas)return!1;try{let t=!1;const s=new Blob(['\n\tself.addEventListener("message", () =>\n\t{\n\t\ttry {\n\t\t\tconst offscreenCanvas = new OffscreenCanvas(32, 32);\n\t\t\tconst gl = offscreenCanvas.getContext("webgl");\n\t\t\tself.postMessage(!!gl);\n\t\t}\n\t\tcatch (err)\n\t\t{\n\t\t\tconsole.warn("Feature detection worker error:", err);\n\t\t\tself.postMessage(false);\n\t\t}\n\t});'],{type:"text/javascript"}),i=new Worker(URL.createObjectURL(s),{get type(){t=!0}}),e=await new Promise(t=>{i.addEventListener("message",s=>{i.terminate(),t(s.data)}),i.postMessage("")});return t&&e}catch(t){return console.warn("Error feature detecting worker mode: ",t),!1}}let r=new Audio;const a={"audio/webm; codecs=opus":!!r.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!r.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!r.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!r.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!r.canPlayType("audio/mp4"),"audio/mpeg":!!r.canPlayType("audio/mpeg")};r=null,window.RealFile=window.File;const c=[],l=new Map,u=new Map;let d=0;const w=[];self.runOnStartup=function(t){if("function"!=typeof t)throw new Error("runOnStartup called without a function");w.push(t)};const f=new Set(["cordova","playable-ad-single-file","playable-ad-zip","instant-games"]);function p(t){return f.has(t)}let m=!1;window.ss=class t{#t=!0;#s=null;#i="";#e="";#h=null;#n=null;#o=[];#r=null;#a=!0;#c=[];#l=[];#u=!1;#d=()=>this.#w();#f=!1;#p=0;#m=null;#g=-1;#y=()=>this.#v();#b=new Set;#S=null;#_=[];#k=[];#P="";constructor(t){if(this.#t=t.es,this.#e=t.hs,this.#P=t.ns,"playable-ad-single-file"!==this.#P&&"playable-ad-zip"!==this.#P&&"instant-games"!==this.#P||(this.#t=!1),(e||"macos-wkwebview"===this.#P)&&(this.#t=!1),"cordova"===this.#P&&this.#t&&i){const t=/Chrome\/(\d+)/i.exec(navigator.userAgent);t&&parseInt(t[1],10)>=90||(this.#t=!1)}this.rs()?self.chrome.webview.addEventListener("message",t=>this.#x(t.data,t.additionalObjects)):"macos-wkwebview"===this.#P?self.C3WrapperOnMessage=t=>this.#x(JSON.parse(t)):"linux-cef"===this.#P&&self.c3_linux_cef_set_message_callback(t=>this.#x(JSON.parse(t))),this.cs=null,this.ls=null,"html5"!==this.#P||window.isSecureContext||console.warn("[Construct] Warning: the browser indicates this is not a secure context. Some features may be unavailable. Use secure (HTTPS) hosting to ensure all features are available."),this.G("canvas","update-size",t=>this.#M(t)),this.G("canvas","set-html-layer-count",t=>this._OnSetHTMLLayerCount(t)),this.G("canvas","cleanup-html-layers",()=>this.#O()),this.G("canvas","update-html-layer-dom-state",t=>this.#R(t.layersDomState)),this.G("runtime","create-job-worker",t=>this.#T(t)),this.G("runtime","send-wrapper-extension-message",t=>this.#C(t)),this.G("runtime","send-raw-wrapper-extension-message",t=>this.#G(t)),"cordova"===this.#P?document.addEventListener("deviceready",()=>this.#I(t)):this.#I(t),this.us=0}et(){this.ds(),this.#s&&(this.#s.onmessage=null,this.#s=null),this.#h&&(this.#h.terminate(),this.#h=null),this.#n&&(this.#n.et(),this.#n=null);for(const{canvas:t,ws:s}of this.#c)t.remove(),s.remove();this.#c.length=0}fs(){return this.#c[0].canvas}jt(t){return Math.min(t,this.#c.length-1)}$t(t){if(t<0||t>=this.#c.length)throw new RangeError("invalid canvas layer");return this.#c[t].ws}_GetHTMLWrapElement(t){return this.$t(t)}ps(){return this.#i}R(){return this.#t}gs(){return this.#P}ys(){return this.#e}vs(){return s&&"cordova"===this.#P}bs(){const t=navigator.userAgent;return s&&p(this.#P)||navigator.standalone||/crios\/|fxios\/|edgios\//i.test(t)}Ss(){return i}_s(){return i&&p(this.#P)}ks(){return"windows-webview2"===this.#P||!!("preview"===this.#P&&window.chrome&&window.chrome.webview&&window.chrome.webview.postMessage)}rs(){return this.ks()||"xbox-uwp-webview2"===this.#P}Ps(){this._s()&&this.us++}xs(){return this.Ms().next().value}*Ms(){if(!this._s())return!0;yield 0===this.us,this.us>0&&this.us--}async#I(t){if(this.#t&&(await o()||(this.#t=!1)),"macos-wkwebview"===this.#P&&this.Os({type:"ready"}),this.rs()||"macos-wkwebview"===this.#P||"linux-cef"===this.#P){this.#E();const t=await this.#A();this.#_=t.registeredComponentIds}if("playable-ad-single-file"===this.#P&&(this.cs=self.c3_base64files,this.ls={},await this.#D()),t.Rs)this.#i=t.Rs;else{const t=location.origin;this.#i=("null"===t?"file:///":t)+location.pathname;const s=this.#i.lastIndexOf("/");-1!==s&&(this.#i=this.#i.substr(0,s+1))}const s=new MessageChannel;if(this.#s=s.port1,this.#s.onmessage=t=>this._OnMessageFromRuntime(t.data),window.c3_addPortMessageHandler&&window.c3_addPortMessageHandler(t=>this.#F(t)),this.#m=new self.Ts(this),await this.#m.Cs(),"object"==typeof window.StatusBar&&window.StatusBar.hide(),"object"==typeof window.AndroidFullScreen)try{await new Promise((t,s)=>{window.AndroidFullScreen.immersiveMode(t,s)})}catch(t){console.error("Failed to enter Android immersive mode: ",t)}this.#t?await this.#L(t,s.port2):await this.#U(t,s.port2)}#W(s){return{runtimeBaseUrl:this.#i,previewUrl:location.href,windowInnerWidth:this.Gs(),windowInnerHeight:this.Is(),cssDisplayMode:this.Es(),devicePixelRatio:window.devicePixelRatio,isFullscreen:t.As(),swClientId:window.cr_swClientId||"",exportType:s.ns,fileMap:globalThis.Ds??new Map(Object.entries(this.cs??{})),scriptFolder:this.#e,isDebug:new URLSearchParams(self.location.search).has("debug"),ife:!!self.Fs,jobScheduler:this.#m.Ls(),supportedAudioFormats:a,isiOSCordova:this.vs(),isiOSWebView:this.bs(),isWindowsWebView2:this.ks(),isAnyWebView2Wrapper:this.rs(),wrapperComponentIds:this.#_,isFBInstantAvailable:void 0!==self.FBInstant}}async#L(t,s){const i=t.Us;"preview"===this.#P?(this.#h=new Worker("previewworker.js",{type:"module",name:"Runtime"}),await new Promise((t,s)=>{const e=i=>{this.#h.removeEventListener("message",e),i.data&&"ok"===i.data.type?t():s()};this.#h.addEventListener("message",e),this.#h.postMessage({type:"construct-worker-init",import:new URL(i,this.#i).toString()})})):this.#h=await this.Ws(i,{type:"module",name:"Runtime"});const e=document.createElement("canvas");e.style.display="none";const h=e.transferControlToOffscreen();document.body.appendChild(e);const n=document.createElement("div");n.className="c3htmlwrap",n.setAttribute("interactive",""),document.body.appendChild(n),this.#c.push({canvas:e,ws:n,Hs:{isVisible:!0,opacity:1,Vs:!0}}),window.c3canvas=e,self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders(),this.#h.postMessage(Object.assign(this.#W(t),{type:"init-runtime",isInWorker:!0,messagePort:s,canvas:h,runtimeScriptList:t.Bs,projectMainScriptPath:t.Ns,javaScriptInEventsPath:t.js,typeScriptInEventsPath:t.$s}),[s,h,...this.#m.zs()]),this.#o=c.map(t=>new t(this)),this.#H(),this.#r.qs(e),this.#r.Ys(n),this.#r.Xs(),self.c3_callFunction=(t,s)=>this.#r.Js(t,s),"preview"===this.#P&&(self.goToLastErrorScript=()=>this._("runtime","go-to-last-error-script"))}async#U(t,s){const i=document.createElement("canvas");i.style.display="none",document.body.appendChild(i);const e=document.createElement("div");e.className="c3htmlwrap",e.setAttribute("interactive",""),document.body.appendChild(e),this.#c.push({canvas:i,ws:e,Hs:{isVisible:!0,opacity:1,Vs:!0}}),window.c3canvas=i,self.C3_InsertHTMLPlaceholders&&self.C3_InsertHTMLPlaceholders(),this.#o=c.map(t=>new t(this)),this.#H(),this.#r.qs(i),this.#r.Ys(e);const h=await Promise.all(t.Bs.map(t=>this.#V(t)));await Promise.all(h.map(t=>n(t)));const o=t.Ns,r=t.js,a=t.$s;if(o)try{if(await n(o),"preview"===this.#P&&!globalThis.Ks)throw new Error("main script did not run to completion")}catch(t){this.#B(),console.error("Error loading project main script: ",t),alert(`Failed to load the project main script (${o}). Check all your JavaScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the script. Press F12 and check the console for error details.`)}if(r)try{if(await n(r),"preview"===this.#P&&!globalThis.Qs.Zs)throw new Error("JavaScript in events did not run to completion")}catch(t){this.#B(),console.error("Error loading JavaScript in events: ",t),alert("Failed to load JavaScript in events. Check all your JavaScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the 'Imports for events' script. Press F12 and check the console for error details.")}if(a)try{if(await n(a),"preview"===this.#P&&!globalThis.Qs.ti)throw new Error("TypeScript in events did not run to completion")}catch(t){this.#B(),console.error("Error loading TypeScript in events: ",t),alert("Failed to load TypeScript in events. Check all your TypeScript code has valid syntax, all imports are written correctly, and that an exception was not thrown running the 'Imports for events' script. Press F12 and check the console for error details.")}const l=Object.assign(this.#W(t),{isInWorker:!1,messagePort:s,canvas:i,runOnStartupFunctions:w});this.#r.Xs(),this.#N(),this.#n=self.C3_CreateRuntime(l),await self.C3_InitRuntime(this.#n,l)}async Ws(t,s){if(t.startsWith("blob:"))return new Worker(t,s);if("playable-ad-single-file"===this.#P){const i=this.cs[t];if(!i)throw new Error("missing script: "+t);return new Worker(URL.createObjectURL(i),s)}const i=new URL(t,location.href);if(location.origin!==i.origin){const t=await fetch(i);if(!t.ok)throw new Error("failed to fetch worker script");const e=await t.blob();return new Worker(URL.createObjectURL(e),s)}return new Worker(i,s)}Gs(){return Math.max(window.innerWidth,1)}Is(){return Math.max(window.innerHeight,1)}Es(){if(this.rs())return"standalone";const t=this.gs();return new Set(["cordova","macos-wkwebview","linux-cef"]).has(t)?"standalone":window.matchMedia("(display-mode: fullscreen)").matches?"fullscreen":window.matchMedia("(display-mode: standalone)").matches?"standalone":window.matchMedia("(display-mode: minimal-ui)").matches?"minimal-ui":navigator.standalone?"standalone":"browser"}#N(){this.#B()}#B(){const t=window.cr_previewLoadingElem;t&&(t.parentElement.removeChild(t),window.cr_previewLoadingElem=null)}async#T(t){const s=await this.#m.si();return{outputPort:s,transferables:[s]}}#M(t){if(this.ii())return;const s=t.styleWidth+"px",i=t.styleHeight+"px",e=t.marginLeft+"px",h=t.marginTop+"px";for(const{canvas:t,ws:n}of this.#c)t.style.width=s,t.style.height=i,t.style.marginLeft=e,t.style.marginTop=h,n.style.width=s,n.style.height=i,n.style.marginLeft=e,n.style.marginTop=h,this.#a&&(t.style.display="",n.style.display="");document.documentElement.style.setProperty("--construct-scale",t.displayScale),this.#a=!1}_OnSetHTMLLayerCount(t){const s=t.count,i=t.layersDomState,e=t.immediate,h=t.styleWidth+"px",n=t.styleHeight+"px",o=t.marginLeft+"px",r=t.marginTop+"px",a=[],c=[];if(s<this.#c.length)for(;this.#c.length>s;){const{canvas:t,ws:s}=this.#c.pop();s.remove(),this.#t&&!e?this.#l.push(t):t.remove()}else if(s>this.#c.length)for(let t=0,i=s-this.#c.length;t<i;++t){const t=document.createElement("canvas");if(t.classList.add("c3overlay"),this.#t){const s=t.transferControlToOffscreen();a.push(s),c.push(s)}else a.push(t);document.body.appendChild(t);const s=document.createElement("div");s.classList.add("c3htmlwrap","c3overlay"),s.setAttribute("interactive",""),document.body.appendChild(s),t.style.width=h,t.style.height=n,t.style.marginLeft=o,t.style.marginTop=r,s.style.width=h,s.style.height=n,s.style.marginLeft=o,s.style.marginTop=r,this.#r.qs(t),this.#r.Ys(s),this.#c.push({canvas:t,ws:s,Hs:{isVisible:!0,opacity:1,Vs:!0}})}this.#R(i);for(const t of this.#o)t instanceof window.Pt&&t.Jt();return this.Xt(),{addedCanvases:a,transferables:c}}#R(t){for(let s=0,i=Math.min(this.#c.length,t.length);s<i;++s){const{ws:i,Hs:e}=this.#c[s],h=t[s],n=h.isVisible,o=h.opacity,r=h.isInteractive;n!==e.isVisible&&(i.style.display=n?"":"none",e.isVisible=n),o!==e.opacity&&(i.style.opacity=1===o?"":String(o),e.opacity=o),r!==e.Vs&&(i.style.pointerEvents=r?"":"none",r?i.setAttribute("interactive",""):i.removeAttribute("interactive"),e.Vs=r)}}#O(){for(const t of this.#l)t.remove();this.#l.length=0}Xt(){this.#u||(this.#u=!0,this.L(this.#d))}#w(){this.W(this.#d),this.#u=!1;let t=[];for(const s of this.#o)if(s instanceof window.Pt){const i=s.Kt();i&&t.push(...i)}t.sort((t,s)=>{const i=t.vt(),e=s.vt();return i!==e?i-e:t._t()-s._t()});let s=0,i=0,e=0,h=t.length;for(;e<h;++e){const h=t[e];h.vt()!==s&&(this.#j(s,t.slice(i,e)),s=h.vt(),i=e)}i<e&&this.#j(s,t.slice(i,e))}#j(t,s){if(s.length<=1)return;if(t>=this.#c.length)return;const i=s.map(t=>t.kt()),e=new Set(i),h=this.$t(t),n=Array.from(h.children).filter(t=>e.has(t));for(let t=0,s=0,e=i.length;t<e;++t){const e=i[t],o=n[s];e===o?++s:h.moveBefore?h.moveBefore(e,o):h.insertBefore(e,o)}}T(t){if(this.#t)throw new Error("not available in worker mode");this.#n._OnMessageFromDOM(t)}_(t,s,i,e,h){this.#s.postMessage({type:"event",component:t,handler:s,dispatchOpts:e||null,data:i,responseId:null},h)}M(t,s,i,e,h){const n=d++,o=new Promise((t,s)=>{u.set(n,{resolve:t,reject:s})});return this.#s.postMessage({type:"event",component:t,handler:s,dispatchOpts:e||null,data:i,responseId:n},h),o}_OnMessageFromRuntime(t){const s=t.type;if("event"===s)return this.#$(t);if("result"===s)this.#z(t);else if("runtime-ready"===s)this.#q();else if("alert-error"===s)this.#B(),alert(t.message);else{if("creating-runtime"!==s)throw new Error(`unknown message '${s}'`);this.#N()}}#$(t){const s=t.component,i=t.handler,e=t.data,h=t.responseId,n=l.get(s);if(!n)return void console.warn(`[DOM] No event handlers for component '${s}'`);const o=n.get(i);if(!o)return void console.warn(`[DOM] No handler '${i}' for component '${s}'`);let r=null;try{r=o(e)}catch(t){return console.error(`Exception in '${s}' handler '${i}':`,t),void(null!==h&&this.#Y(h,!1,""+t))}if(null===h)return r;r&&r.then?r.then(t=>this.#Y(h,!0,t)).catch(t=>{console.error(`Rejection from '${s}' handler '${i}':`,t),this.#Y(h,!1,""+t)}):this.#Y(h,!0,r)}#Y(t,s,i){let e;i&&i.transferables&&(e=i.transferables),this.#s.postMessage({type:"result",responseId:t,isOk:s,result:i},e)}#z(t){const s=t.responseId,i=t.isOk,e=t.result,h=u.get(s);i?h.resolve(e):h.reject(e),u.delete(s)}G(t,s,i){let e=l.get(t);if(e||(e=new Map,l.set(t,e)),e.has(s))throw new Error(`[DOM] Component '${t}' already has handler '${s}'`);e.set(s,i)}static ei(t){if(c.includes(t))throw new Error("DOM handler already added");c.push(t)}#H(){for(const t of this.#o)if("runtime"===t.D())return void(this.#r=t);throw new Error("cannot find runtime DOM handler")}#F(t){this._("debugger","message",t)}#q(){for(const t of this.#o)t.v()}static As(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||m)}static hi(t){m=!!t}async ni(){return await this.M("runtime","get-remote-preview-status-info")}L(t){this.#b.add(t),this.oi()}W(t){this.#b.delete(t),0===this.#b.size&&this.ds()}oi(){-1===this.#g&&this.#b.size>0&&(this.#g=requestAnimationFrame(this.#y))}ds(){-1!==this.#g&&(cancelAnimationFrame(this.#g),this.#g=-1)}#v(){this.#g=-1;for(const t of this.#b)t();this.oi()}ri(t){this.#r.ri(t)}ai(t){this.#r.ai(t)}ci(){this.#r.ci()}li(t){this.#r.li(t)}di(t){return!!a[t]}wi(t){this.#f=!0,this.#p=t}ii(){return this.#f}fi(){return this.#p}pi(t){return/^(?:[a-z\-]+:)?\/\//.test(t)||"data:"===t.substr(0,5)||"blob:"===t.substr(0,5)}mi(t){return!this.pi(t)}async#V(t){if("playable-ad-single-file"===this.#P){if(this.ls.hasOwnProperty(t))return{Qt:!0,ts:this.ls[t]};if(this.cs.hasOwnProperty(t))return URL.createObjectURL(this.cs[t]);throw new Error("missing script: "+t)}return t}_PlayableAdFetchBlob(t){if(this.cs.hasOwnProperty(t))return this.cs[t];throw new Error("missing file: "+t)}#X(){const t=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;if("object"!=typeof t)throw new Error("Permission API is not loaded");return t}#J(t,s){const i=t[s];if("string"!=typeof i)throw new Error("Invalid permission name");return i}#K(t){const s=this.#X();return new Promise((i,e)=>s.checkPermission(this.#J(s,t),t=>i(!!t.hasPermission),e))}#Z(t){const s=this.#X();return new Promise((i,e)=>s.requestPermission(this.#J(s,t),t=>i(!!t.hasPermission),e))}async gi(t){if("cordova"!==this.gs())return!0;if(this.vs())return!0;for(const s of t)if(!await this.#K(s)&&!1===await this.#Z(s))return!1;return!0}async yi(...t){if(!1===await this.gi(t))throw new Error("Permission not granted")}#x(s,i){if("object"!=typeof s||!s)return void console.warn("Unknown wrapper message: ",s);const e=s.type;if("directory-handles"===e)this.#k=i;else if("wrapper-init-response"===e)this.#S(s),this.#S=null;else if("fullscreen-change"===e)t.hi(s.isFullscreen),this.#r.bi();else if("log-to-console"===e)switch(s.logType){case"error":console.error(s.message);break;case"warning":console.warn(s.message);break;default:console.log(s.message)}else if("window-maximized"==e||"window-minimized"==e){const t={"window-maximized":"windowmaximize","window-minimized":"windowminimize"};this._("runtime",t[e],null,{dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0})}else"extension-message"===e?this._("runtime","wrapper-extension-message",s):console.warn("Unknown wrapper message: ",s)}#C(t){this.Os({type:"extension-message",componentId:t.componentId,messageId:t.messageId,params:t.params||[],asyncId:t.asyncId})}#G(t){this.Os(t)}Os(t){this.rs()?window.chrome.webview.postMessage(JSON.stringify(t)):"macos-wkwebview"===this.#P?window.webkit.messageHandlers.C3Wrapper.postMessage(JSON.stringify(t)):"linux-cef"===this.#P&&window.c3_linux_cef_sendmessage(JSON.stringify(t))}#E(){window.moveTo=(t,s)=>{this.Os({type:"set-window-position",windowX:Math.ceil(t),windowY:Math.ceil(s)})},window.resizeTo=(t,s)=>{this.Os({type:"set-window-size",windowWidth:Math.ceil(t),windowHeight:Math.ceil(s)})},window.focus=()=>{this.Os({type:"focus-window"})}}#A(){return new Promise(t=>{this.#S=t,this.Os({type:"wrapper-init"})})}Si(){return this.#k}async#D(){const t=[];for(const[s,i]of Object.entries(this.cs))t.push(this.#Q(s,i));await Promise.all(t)}async#Q(t,s){if("object"==typeof s)this.cs[t]=new Blob([s.str],{type:s.type}),this.ls[t]=s.str;else{let i=await this.#tt(s);i||(i=this.#st(s)),this.cs[t]=i}}async#tt(t){try{const s=await fetch(t);return await s.blob()}catch(t){return console.warn("Failed to fetch a data: URI. Falling back to a slower workaround. This is probably because the Content Security Policy unnecessarily blocked it. Allow data: URIs in your CSP to avoid this.",t),null}}#st(t){const s=this.#it(t);return this.#et(s.data,s._i)}#it(t){const s=t.indexOf(",");if(s<0)throw new URIError("expected comma in data: uri");const i=t.substring(5,s),e=t.substring(s+1),h=i.split(";"),n=h[0]||"",o=h[1],r=h[2];let a;return a="base64"===o||"base64"===r?atob(e):decodeURIComponent(e),{_i:n,data:a}}#et(t,s){let i,e,h=t.length,n=h>>2,o=new Uint8Array(h),r=new Uint32Array(o.buffer,0,n);for(i=0,e=0;i<n;++i)r[i]=t.charCodeAt(e++)|t.charCodeAt(e++)<<8|t.charCodeAt(e++)<<16|t.charCodeAt(e++)<<24;let a=3&h;for(;a--;)o[e]=t.charCodeAt(e),++e;return new Blob([o],{type:s})}}}{const g=self.ss,y=/firefox/i.test(navigator.userAgent);function v(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents||t.originalEvent&&t.originalEvent.sourceCapabilities&&t.originalEvent.sourceCapabilities.firesTouchEvents}const b=new Map([["OSLeft","MetaLeft"],["OSRight","MetaRight"]]),S={dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0},_={dispatchUserScriptEvent:!0},k={dispatchRuntimeEvent:!0};async function P(t){const s=URL.createObjectURL(t);try{return await(i=s,new Promise((t,s)=>{const e=new Image;e.onload=()=>t(e),e.onerror=t=>s(t),e.src=i}))}finally{URL.revokeObjectURL(s)}var i}function x(t){do{if(t.parentNode&&t.hasAttribute("contenteditable"))return!0;t=t.parentNode}while(t);return!1}const M=new Set(["input","textarea","datalist","select"]),O=new Set(["canvas","body","html"]);function R(t){if(!t.target.tagName)return;const s=t.target.tagName.toLowerCase();O.has(s)&&t.preventDefault()}function T(t){t.target.tagName&&t.target.classList.contains("c3htmlwrap")&&t.preventDefault()}function C(t){(t.metaKey||t.ctrlKey)&&t.preventDefault()}self.C3_GetSvgImageSize=async function(t){const s=await P(t);if(s.width>0&&s.height>0)return[s.width,s.height];{s.style.position="absolute",s.style.left="0px",s.style.top="0px",s.style.visibility="hidden",document.body.appendChild(s);const t=s.getBoundingClientRect();return document.body.removeChild(s),[t.width,t.height]}},self.C3_RasterSvgImageBlob=async function(t,s,i,e,h){const n=await P(t),o=document.createElement("canvas");return o.width=e,o.height=h,o.getContext("2d").drawImage(n,0,0,s,i),o};let G=!1;function I(){try{return window.parent&&window.parent.document.hasFocus()}catch(t){return!1}}document.addEventListener("pause",()=>G=!0),document.addEventListener("resume",()=>G=!1);const E="runtime",A=class extends self.i{constructor(t){super(t,E),this.ki=!1,this.Pi=-1,this.xi="any",this.Mi=!1,this.Oi=!1,this.Ri=!1,this.Ti=document.createElement("div"),this.Ti.className="c3-screen-reader-text",this.Ti.setAttribute("aria-live","polite"),document.body.appendChild(this.Ti),this.Ci=null,this.Gi=!1,this.Ii="",this.Ei=-1,this.Ai=!1,this.Di=t.Gs(),this.Fi=t.Is(),this.Li=0,this.Ui=0,t.G("runtime","invoke-download",t=>this.Wi(t)),t.G("runtime","load-webfonts",t=>this.Hi(t)),t.G("runtime","raster-svg-image",t=>this.Vi(t)),t.G("runtime","get-svg-image-size",t=>this.Bi(t)),t.G("runtime","set-target-orientation",t=>this.Ni(t)),t.G("runtime","register-sw",()=>this.ji()),t.G("runtime","post-to-debugger",t=>this.$i(t)),t.G("runtime","go-to-script",t=>this.$i(t)),t.G("runtime","before-start-ticking",()=>this.zi()),t.G("runtime","debug-highlight",t=>this.Yi(t)),t.G("runtime","enable-device-orientation",()=>this.Xi()),t.G("runtime","enable-device-motion",()=>this.Ji()),t.G("runtime","add-stylesheet",t=>this.Ki(t)),t.G("runtime","script-create-worker",t=>this.Zi(t)),t.G("runtime","alert",t=>this.Qi(t)),t.G("runtime","screen-reader-text",t=>this.te(t)),t.G("runtime","hide-cordova-splash",()=>this.se()),t.G("runtime","set-exporting-to-video",t=>this.ie(t)),t.G("runtime","export-to-video-progress",t=>this.ee(t)),t.G("runtime","exported-to-video",t=>this.he(t)),t.G("runtime","exported-to-image-sequence",t=>this.ne(t));const s=new Set(["input","textarea","datalist"]);if(window.addEventListener("contextmenu",t=>{const i=t.target,e=i.tagName.toLowerCase();s.has(e)||x(i)||t.preventDefault()}),window.addEventListener("selectstart",R),window.addEventListener("gesturehold",R),window.addEventListener("touchstart",R,{passive:!1}),window.addEventListener("pointerdown",R,{passive:!1}),this.oe=0,window.addEventListener("mousedown",t=>{1===t.button&&t.preventDefault()}),window.addEventListener("mousewheel",C,{passive:!1}),window.addEventListener("wheel",C,{passive:!1}),window.addEventListener("resize",()=>this.re()),window.addEventListener("fullscreenchange",()=>this.bi()),window.addEventListener("webkitfullscreenchange",()=>this.bi()),window.addEventListener("mozfullscreenchange",()=>this.bi()),window.addEventListener("fullscreenerror",t=>this.ae(t)),window.addEventListener("webkitfullscreenerror",t=>this.ae(t)),window.addEventListener("mozfullscreenerror",t=>this.ae(t)),t.bs()){let t=1/0;window.visualViewport.addEventListener("resize",()=>{const s=window.visualViewport.height;s>t&&(document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0),t=s}),document.documentElement.setAttribute("ioswebview","")}this.ce=new Set,this.le=new WeakSet,this.ue=!1}qs(t){t.addEventListener("selectstart",R),t.addEventListener("gesturehold",R),t.addEventListener("pointerdown",R)}Ys(t){t.addEventListener("selectstart",T),t.addEventListener("gesturehold",T),t.addEventListener("touchstart",T),t.addEventListener("dragstart",T)}zi(){return self.setTimeout(()=>{this.Ai=!0},1e3),"cordova"===this.h.gs()?(document.addEventListener("pause",()=>this.de(!0)),document.addEventListener("resume",()=>this.de(!1))):document.addEventListener("visibilitychange",()=>this.de("hidden"===document.visibilityState)),this.Ri=!("hidden"!==document.visibilityState&&!G),{isSuspended:this.Ri}}v(){window.addEventListener("focus",()=>this.we("window-focus")),window.addEventListener("blur",()=>{this.we("window-blur",{parentHasFocus:I()}),this.oe=0}),window.addEventListener("focusin",t=>{var s;s=t.target,(M.has(s.tagName.toLowerCase())||x(s))&&this.we("keyboard-blur")}),window.addEventListener("keydown",t=>this.fe("keydown",t)),window.addEventListener("keyup",t=>this.fe("keyup",t)),window.addEventListener("mousedown",t=>this.pe("mousedown",t,_)),window.addEventListener("mousemove",t=>this.pe("mousemove",t,_)),window.addEventListener("mouseup",t=>this.pe("mouseup",t,_)),window.addEventListener("dblclick",t=>this.pe("dblclick",t,S)),window.addEventListener("wheel",t=>this.me("wheel",t,S)),window.addEventListener("pointerdown",t=>{this.ge(t),this.ye("pointerdown",t)}),this.h.R()&&void 0!==window.onpointerrawupdate&&self===self.top&&!y?window.addEventListener("pointerrawupdate",t=>this.ve(t)):window.addEventListener("pointermove",t=>this.ye("pointermove",t)),window.addEventListener("pointerup",t=>this.ye("pointerup",t)),window.addEventListener("pointercancel",t=>this.ye("pointercancel",t));const t=()=>this.ci();window.addEventListener("pointerup",t,!0),window.addEventListener("touchend",t,!0),window.addEventListener("click",t,!0),window.addEventListener("keydown",t,!0),window.addEventListener("gamepadconnected",t,!0),this.h.Ss()&&!this.h._s()&&navigator.virtualKeyboard&&(navigator.virtualKeyboard.overlaysContent=!0,navigator.virtualKeyboard.addEventListener("geometrychange",()=>{this.be(this.Is(),navigator.virtualKeyboard.boundingRect.height)})),this.h.bs()&&(document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0)}be(t,s){if(document.body.style.position="",document.body.style.overflow="",document.body.style.transform="",this.Ui=0,s>0){const i=document.activeElement;if(i){const e=i.getBoundingClientRect();let h=(e.top+e.bottom)/2-(t-s)/2;h>s&&(h=s),h<0&&(h=0),h>0&&(document.body.style.position="absolute",document.body.style.overflow="visible",document.body.style.transform=`translateY(${-h}px)`,this.Ui=h)}}}we(t,s){this.S(t,s||null,k)}Gs(){return this.h.Gs()}Is(){return this.h.Is()}Xs(){this.ki=!0,this.Di=this.h.Gs(),this.Fi=this.h.Is()}re(){if(this.Gi)return;if(!this.ki)return;const t=this.Gs(),s=this.Is();if(this.h._s())if(this.Ai){if(this.h.xs()&&this.Di===t&&s<this.Fi)return this.Li=this.Fi-s,void this.be(this.Fi,this.Li);this.Li>0&&(this.Li=0,this.be(s,this.Li)),this.Di=t,this.Fi=s}else this.Di=t,this.Fi=s;this.S("window-resize",{innerWidth:t,innerHeight:s,devicePixelRatio:window.devicePixelRatio,isFullscreen:g.As(),cssDisplayMode:this.h.Es()}),this.h.bs()&&(-1!==this.Pi&&clearTimeout(this.Pi),this.Se(t,s,0))}_e(t,s,i){-1!==this.Pi&&clearTimeout(this.Pi),this.Pi=setTimeout(()=>this.Se(t,s,i),48)}Se(t,s,i){const e=this.Gs(),h=this.Is();this.Pi=-1,e!=t||h!=s?this.S("window-resize",{innerWidth:e,innerHeight:h,devicePixelRatio:window.devicePixelRatio,isFullscreen:g.As(),cssDisplayMode:this.h.Es()}):i<10&&this._e(e,h,i+1)}Ni(t){this.xi=t.targetOrientation}ke(){const t=this.xi;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(t).catch(t=>console.warn("[Construct] Failed to lock orientation: ",t));else try{let s=!1;screen.lockOrientation?s=screen.lockOrientation(t):screen.webkitLockOrientation?s=screen.webkitLockOrientation(t):screen.mozLockOrientation?s=screen.mozLockOrientation(t):screen.msLockOrientation&&(s=screen.msLockOrientation(t)),s||console.warn("[Construct] Failed to lock orientation")}catch(t){console.warn("[Construct] Failed to lock orientation: ",t)}}bi(){if(this.Gi)return;const t=g.As();t&&"any"!==this.xi&&this.ke(),this.S("fullscreenchange",{isFullscreen:t,innerWidth:this.Gs(),innerHeight:this.Is()})}ae(t){console.warn("[Construct] Fullscreen request failed: ",t),this.S("fullscreenerror",{isFullscreen:g.As(),innerWidth:this.Gs(),innerHeight:this.Is()})}de(t){if(this.Ri!==t&&(this.Ri=t,t?this.h.ds():this.h.oi(),this.S("visibilitychange",{hidden:t}),!t&&this.h.bs())){const t=()=>{document.scrollingElement.scrollTop=0,document.scrollingElement.scrollLeft=0};setTimeout(t,50),setTimeout(t,100),setTimeout(t,250),setTimeout(t,500)}}fe(t,s){if(void 0===s.key)return;if("Backspace"===s.key&&R(s),this.Gi)return;const i=b.get(s.code)||s.code;this.O(t,{code:i,key:s.key,which:s.which,repeat:s.repeat,altKey:s.altKey,ctrlKey:s.ctrlKey,metaKey:s.metaKey,shiftKey:s.shiftKey,timeStamp:s.timeStamp},S)}me(t,s,i){this.Gi||this.S(t,{clientX:s.clientX,clientY:s.clientY+this.Ui,pageX:s.pageX,pageY:s.pageY+this.Ui,deltaX:s.deltaX,deltaY:s.deltaY,deltaZ:s.deltaZ,deltaMode:s.deltaMode,timeStamp:s.timeStamp},i)}pe(t,s,i){this.Gi||v(s)||this.O(t,{button:s.button,buttons:s.buttons,clientX:s.clientX,clientY:s.clientY+this.Ui,pageX:s.pageX,pageY:s.pageY+this.Ui,movementX:s.movementX||0,movementY:s.movementY||0,timeStamp:s.timeStamp},i)}ye(t,s){if(this.Gi)return;let i=0;"mouse"===s.pointerType&&(i=this.oe),this.O(t,{pointerId:s.pointerId,pointerType:s.pointerType,button:s.button,buttons:s.buttons,lastButtons:i,clientX:s.clientX,clientY:s.clientY+this.Ui,pageX:s.pageX,pageY:s.pageY+this.Ui,movementX:s.movementX||0,movementY:s.movementY||0,width:s.width||0,height:s.height||0,pressure:s.pressure||0,tangentialPressure:s.tangentialPressure||0,tiltX:s.tiltX||0,tiltY:s.tiltY||0,twist:s.twist||0,timeStamp:s.timeStamp},S),"mouse"===s.pointerType&&(this.oe=s.buttons)}ve(t){this.ye("pointermove",t)}Pe(t,s){if(!this.Gi)for(let i=0,e=s.changedTouches.length;i<e;++i){const e=s.changedTouches[i];this.O(t,{pointerId:e.identifier,pointerType:"touch",button:0,buttons:0,lastButtons:0,clientX:e.clientX,clientY:e.clientY+this.Ui,pageX:e.pageX,pageY:e.pageY+this.Ui,movementX:s.movementX||0,movementY:s.movementY||0,width:2*(e.radiusX||e.webkitRadiusX||0),height:2*(e.radiusY||e.webkitRadiusY||0),pressure:e.force||e.webkitForce||0,tangentialPressure:0,tiltX:0,tiltY:0,twist:e.rotationAngle||0,timeStamp:s.timeStamp},S)}}ge(t){window!==window.top&&window.focus(),this.xe(t.target)&&document.activeElement&&!this.xe(document.activeElement)&&document.activeElement.blur()}xe(t){return!t||t===document||t===window||t===document.body||"canvas"===t.tagName.toLowerCase()}Xi(){this.Mi||(this.Mi=!0,window.addEventListener("deviceorientation",t=>this.Me(t)),window.addEventListener("deviceorientationabsolute",t=>this.Oe(t)))}Ji(){this.Oi||(this.Oi=!0,window.addEventListener("devicemotion",t=>this.Re(t)))}Me(t){this.Gi||this.S("deviceorientation",{absolute:!!t.absolute,alpha:t.alpha||0,beta:t.beta||0,gamma:t.gamma||0,timeStamp:t.timeStamp,webkitCompassHeading:t.webkitCompassHeading,webkitCompassAccuracy:t.webkitCompassAccuracy},S)}Oe(t){this.Gi||this.S("deviceorientationabsolute",{absolute:!!t.absolute,alpha:t.alpha||0,beta:t.beta||0,gamma:t.gamma||0,timeStamp:t.timeStamp},S)}Re(t){if(this.Gi)return;let s=null;const i=t.acceleration;i&&(s={x:i.x||0,y:i.y||0,z:i.z||0});let e=null;const h=t.accelerationIncludingGravity;h&&(e={x:h.x||0,y:h.y||0,z:h.z||0});let n=null;const o=t.rotationRate;o&&(n={alpha:o.alpha||0,beta:o.beta||0,gamma:o.gamma||0}),this.S("devicemotion",{acceleration:s,accelerationIncludingGravity:e,rotationRate:n,interval:t.interval,timeStamp:t.timeStamp},S)}Wi(t){const s=t.url,i=t.filename,e=document.createElement("a"),h=document.body;e.textContent=i,e.href=s,e.download=i,h.appendChild(e),e.click(),h.removeChild(e)}async Hi(t){const s=t.webfonts;await Promise.all(s.map(async t=>{const s=new FontFace(t.name,`url('${t.url}')`);document.fonts.add(s),await s.load()}))}async Vi(t){const s=t.blob,i=t.imageWidth,e=t.imageHeight,h=t.surfaceWidth,n=t.surfaceHeight,o=t.imageBitmapOpts,r=await self.C3_RasterSvgImageBlob(s,i,e,h,n);let a;return a=o?await createImageBitmap(r,o):await createImageBitmap(r),{imageBitmap:a,transferables:[a]}}async Bi(t){return await self.C3_GetSvgImageSize(t.blob)}async Ki(t){var s;await(s=t.url,new Promise((t,i)=>{const e=document.createElement("link");e.onload=()=>t(e),e.onerror=t=>i(t),e.rel="stylesheet",e.href=s,document.head.appendChild(e)}))}ci(){const t=[...this.ce];if(this.ce.clear(),!this.ue)for(const s of t){const t=s.play();t&&t.catch(t=>{this.le.has(s)||this.ce.add(s)})}}ri(t){if("function"!=typeof t.play)throw new Error("missing play function");let s;this.le.delete(t);try{s=t.play()}catch(s){return void this.ce.add(t)}s&&s.catch(s=>{this.le.has(t)||this.ce.add(t)})}ai(t){this.ce.delete(t),this.le.add(t)}li(t){this.ue=!!t}se(){navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide()}Yi(t){if(!t.show)return void(this.Ci&&(this.Ci.style.display="none"));this.Ci||(this.Ci=document.createElement("div"),this.Ci.id="inspectOutline",document.body.appendChild(this.Ci));const s=this.Ci;s.style.display="",s.style.left=t.left-1+"px",s.style.top=t.top-1+"px",s.style.width=t.width+2+"px",s.style.height=t.height+2+"px",s.textContent=t.name}ji(){window.C3_RegisterSW&&window.C3_RegisterSW()}$i(t){window.c3_postToMessagePort&&(t.from="runtime",window.c3_postToMessagePort(t))}Js(t,s){return this.P("js-invoke-function",{name:t,params:s})}Zi(t){const s=t.url,i=t.opts,e=t.port2;new Worker(s,i).postMessage({type:"construct-worker-init",port2:e},[e])}Qi(t){alert(t.message)}te(t){const s=t.type;if("create"===s){const s=document.createElement("p");s.id="c3-sr-"+t.id,s.textContent=t.text,this.Ti.appendChild(s)}else if("update"===s){const s=document.getElementById("c3-sr-"+t.id);s?s.textContent=t.text:console.warn(`[Construct] Missing screen reader text with id ${t.id}`)}else if("release"===s){const s=document.getElementById("c3-sr-"+t.id);s?s.remove():console.warn(`[Construct] Missing screen reader text with id ${t.id}`)}else console.warn(`[Construct] Unknown screen reader text update '${s}'`)}ie(t){this.Gi=!0;const s=document.createElement("h1");s.id="exportToVideoMessage",s.textContent=t.message,document.body.prepend(s),document.body.classList.add("exportingToVideo"),this.A().fs().style.display="",this.h.wi(t.duration)}ee(t){this.Ii=t.message,-1===this.Ei&&(this.Ei=setTimeout(()=>this.Te(),250))}Te(){this.Ei=-1;const t=document.getElementById("exportToVideoMessage");t&&(t.textContent=this.Ii)}he(t){window.Ce({type:"exported-video",arrayBuffer:t.arrayBuffer,contentType:t.contentType,time:t.time})}ne(t){window.Ce({type:"exported-image-sequence",blobArr:t.blobArr,time:t.time,gif:t.gif})}};g.ei(A)}{const D="dispatchworker.js",F="jobworker.js";self.Ts=class{constructor(t){this.Ge=t,this.Ie=Math.min(navigator.hardwareConcurrency||2,16),this.Ee=null,this.Ae=[],this.De=null,this.Fe=null}async Cs(){if(this.Le)throw new Error("already initialised");this.Le=!0;const t=this.Ge.ys()+D;this.Ee=await this.Ge.Ws(t,{name:"DispatchWorker"});const s=new MessageChannel;this.De=s.port1,this.Ee.postMessage({type:"_init","in-port":s.port2},[s.port2]),this.Fe=await this.si()}async si(){const t=this.Ae.length,s=this.Ge.ys()+F,i=await this.Ge.Ws(s,{name:"JobWorker"+t}),e=new MessageChannel,h=new MessageChannel;return this.Ee.postMessage({type:"_addJobWorker",port:e.port1},[e.port1]),i.postMessage({type:"init",number:t,"dispatch-port":e.port2,"output-port":h.port2},[e.port2,h.port2]),this.Ae.push(i),h.port1}Ls(){return{inputPort:this.De,outputPort:this.Fe,maxNumWorkers:this.Ie}}zs(){return[this.De,this.Fe]}}}{const L=180/Math.PI,U="audio";self.Ue=class extends self.i{constructor(t){super(t,U),this.We=null,this.He=null,this.Ve=!1,this.Be=()=>this.Ne(),this.je=[],this.$e=[],this.ze=null,this.qe=[],this.Ye=new Set,this.Xe=-1,this.Je=new Map,this.Ke=1,this.ue=!1,this.Ze=0,this.Qe=1,this.th=0,this.sh="HRTF",this.ih="inverse",this.eh=600,this.hh=1e4,this.nh=1,this.oh=[0,0,0],this.rh=[0,0,-1,0,1,0],this.ah=!1,this.uh=null,this.dh=new Map,this.wh=new Set,this.fh=!1,this.ph=!1,this.mh="",this.gh=null,self.C3Audio_OnMicrophoneStream=(t,s)=>this.yh(t,s),this.bh=null,self.C3Audio_GetOutputStream=()=>this.Sh(),self.C3Audio_DOMInterface=this,this.I([["create-audio-context",t=>this._h(t)],["play",t=>this.kh(t)],["stop",t=>this.Ph(t)],["stop-all",()=>this.xh()],["set-paused",t=>this.Mh(t)],["set-volume",t=>this.Oh(t)],["fade-volume",t=>this.Rh(t)],["set-master-volume",t=>this.Th(t)],["set-muted",t=>this.Ch(t)],["set-silent",t=>this.Gh(t)],["set-looping",t=>this.Ih(t)],["set-playback-rate",t=>this.Eh(t)],["set-stereo-pan",t=>this.Ah(t)],["seek",t=>this.Dh(t)],["preload",t=>this.Fh(t)],["unload",t=>this.Lh(t)],["unload-all",()=>this.Uh()],["set-suspended",t=>this.Wh(t)],["add-effect",t=>this.Hh(t)],["set-effect-param",t=>this.Vh(t)],["remove-effects",t=>this.Bh(t)],["tick",t=>this.Nh(t)],["load-state",t=>this.jh(t)],["offline-render-audio",t=>this.$h(t)],["offline-render-finish",()=>this.zh()]])}async _h(t){if(t.usePlayMusicAsSoundWorkaround&&(this.ah=!0),this.Ze=t.timeScaleMode,this.sh=["equalpower","HRTF","soundfield"][t.panningModel],this.ih=["linear","inverse","exponential"][t.distanceModel],this.eh=t.refDistance,this.hh=t.maxDistance,this.nh=t.rolloffFactor,this.h.ii()){this.ah=!0;const t=48e3;this.We=new OfflineAudioContext({numberOfChannels:2,sampleRate:t,length:Math.ceil(this.h.fi()*t)})}else this.We=new AudioContext({latencyHint:t.latencyHint}),"running"!==this.We.state&&this.qh(),this.We.onstatechange=()=>{"running"===this.We.state?this.Yh():this.qh(),this.S("audiocontext-state",{audioContextState:this.We.state})};this.He=this.We.createGain(),this.He.connect(this.We.destination);const s=t.listenerPos;this.oh[0]=s[0],this.oh[1]=s[1],this.oh[2]=s[2],this.We.listener.setPosition(s[0],s[1],s[2]),this.We.listener.setOrientation(...this.rh),self.C3_GetAudioContextCurrentTime=()=>this.Xh();try{await Promise.all(t.preloadList.map(t=>this.Jh(t.originalUrl,t.url,t.type,!1)))}catch(t){console.error("[Construct] Preloading sounds failed: ",t)}return{sampleRate:this.We.sampleRate,audioContextState:this.We.state,outputLatency:this.We.outputLatency||0}}qh(){this.Ve||(window.addEventListener("pointerup",this.Be,!0),window.addEventListener("touchend",this.Be,!0),window.addEventListener("click",this.Be,!0),window.addEventListener("keydown",this.Be,!0),this.h.bs()||document.addEventListener("visibilitychange",this.Be),this.Ve=!0)}Yh(){this.Ve&&(window.removeEventListener("pointerup",this.Be,!0),window.removeEventListener("touchend",this.Be,!0),window.removeEventListener("click",this.Be,!0),window.removeEventListener("keydown",this.Be,!0),this.h.bs()||document.removeEventListener("visibilitychange",this.Be),this.Ve=!1)}Ne(){"running"!==this.We.state&&this.We.resume()}Kh(t,s){for(const i of s){let s=!1;for(const e of t)if(self.Ue.Zh(e,i)){s=!0;break}if(!s)return!1}return!0}Qh(){return this.We}Xh(){return this.We.currentTime}tn(){return this.He}GetAudioContextExtern(){return this.Qh()}GetDestinationNodeExtern(){return this.tn()}sn(t){const s=this.dh.get(t.toLowerCase());return s?s[0].en():this.tn()}hn(t,s){t=t.toLowerCase();let i=this.dh.get(t);i||(i=[],this.dh.set(t,i)),s.nn(i.length),s.rn(t),i.push(s),this.an(t)}an(t){t=t.toLowerCase();let s=this.tn();const i=this.dh.get(t);if(i&&i.length){s=i[0].en();for(let t=0,s=i.length;t<s;++t){const e=i[t];t+1===s?e.cn(this.tn()):e.cn(i[t+1].en())}}for(const i of this.ln(t))i.un(s);this.gh&&this.mh===t&&(this.gh.disconnect(),this.gh.connect(s))}dn(){return this.Ke}wn(){return this.ue}fn(){return this.Ze}pn(){return this.Qe}mn(){return this.th}gn(){return this.ah}yn(){return this.sh}vn(){return this.ih}bn(){return this.eh}Sn(){return this.hh}_n(){return this.nh}ri(t){this.h.ri(t)}ai(t){this.h.ai(t)}kn(t){let s=0;for(let i=0,e=this.$e.length;i<e;++i){const e=this.$e[i];this.$e[s]=e,e.Pn()===t?e.et():++s}this.$e.length=s}xn(){let t=0;for(let s=0,i=this.je.length;s<i;++s){const i=this.je[s];this.je[t]=i,i.Mn()&&i!==this.uh?i.et():++t}this.je.length=t}*On(t){if(t.length>0)for(const s of this.$e)this.Kh(s.Rn(),t)&&(yield s);else this.ze&&!this.ze.Tn()&&(yield this.ze)}*ln(t){if(t)for(const s of this.$e)self.Ue.Zh(s.Cn(),t)&&(yield s);else this.ze&&!this.ze.Tn()&&(yield this.ze)}async Jh(t,s,i,e,h){for(const t of this.je)if(t.Gn()===s)return e&&this.ah&&(this.uh=t),await t.In(),t;if(h)return null;e&&this.ah&&this.xn();const n=self.An.En(this,t,s,i,e);return this.je.push(n),e&&this.ah&&(this.uh=n),await n.In(),this.Ye.has(t)||(this.S("buffer-metadata",{originalUrl:t,duration:n.Dn()}),this.Ye.add(t)),n}async Fn(t,s,i,e,h){for(const t of this.$e)if(t.Gn()===s&&(t.Ln()||h))return h&&this.ah&&(this.uh=t.Pn()),t.Un(e),t;const n=await this.Jh(t,s,i,h);if(n.Wn())throw new Error(`buffer '${t}' unloaded while loading`);const o=n.Hn(e);return this.$e.push(o),o}Vn(t){const s=t.join(" ");let i=this.Je.get(s);if(!i){let t=null;i={Bn:0,promise:new Promise(s=>t=s),resolve:t},this.Je.set(s,i)}i.Bn++}Nn(t){const s=t.join(" "),i=this.Je.get(s);if(!i)throw new Error("expected pending tag");i.Bn--,0===i.Bn&&(i.resolve(),this.Je.delete(s))}jn(t){const s=(0===t.length?this.qe:t).join(" "),i=this.Je.get(s);return i?i.promise:Promise.resolve()}$n(){if(this.wh.size>0)this.F();else for(const t of this.$e)if(t.zn())return void this.F()}m(){for(const t of this.wh)t.m();const t=this.Xh();for(const s of this.$e)s.m(t);const s=this.$e.filter(t=>t.zn()).map(t=>t.qn());this.S("state",{tickCount:this.Xe,outputLatency:this.We.outputLatency||0,audioInstances:s,analysers:[...this.wh].map(t=>t.Yn())}),0===s.length&&0===this.wh.size&&this.U()}Xn(t,s,i){this.S("trigger",{type:t,tags:s,aiid:i})}async kh(t){const s=t.originalUrl,i=t.url,e=t.type,h=t.isMusic,n=t.tags,o=t.isLooping,r=t.vol,a=t.pos,c=t.panning,l=t.stereoPan;let u=t.off;u>0&&!t.trueClock&&(u+=this.Xh()),this.qe=n.slice(0),this.Vn(n);try{this.ze=await this.Fn(s,i,e,n,h),c?(this.ze.Jn(!0),this.ze.Kn(c.x,c.y,c.z,c.angle,c.innerAngle,c.outerAngle,c.outerGain),c.hasOwnProperty("uid")&&this.ze.Zn(c.uid)):"number"==typeof l&&0!==l?(this.ze.Qn(!0),this.ze.so(l)):(this.ze.Jn(!1),this.ze.Qn(!1)),this.ze.Play(o,r,a,u)}catch(t){return void console.error("[Construct] Audio: error starting playback: ",t)}finally{this.Nn(n)}this.F()}Ph(t){const s=t.tags;for(const t of this.On(s))t.io()}xh(){for(const t of this.$e)t.io()}Mh(t){const s=t.tags,i=t.paused;for(const t of this.On(s))i?t.eo():t.ho();this.$n()}Oh(t){const s=t.tags,i=t.vol;for(const t of this.On(s))t.no(i)}Ah(t){const s=t.tags,i=t.p;for(const t of this.On(s))t.Qn(!0),t.so(i)}async Rh(t){const s=t.tags,i=t.vol,e=t.duration,h=t.stopOnEnd;await this.jn(s);for(const t of this.On(s))t.oo(i,e,h);this.$n()}Th(t){this.Ke=t.vol,this.He.gain.value=this.Ke}Ch(t){const s=t.tags,i=t.isMuted;for(const t of this.On(s))t.ro(i)}Gh(t){this.ue=t.isSilent,this.h.li(this.ue);for(const t of this.$e)t.ao()}Ih(t){const s=t.tags,i=t.isLooping;for(const t of this.On(s))t.co(i)}async Eh(t){const s=t.tags,i=t.rate;await this.jn(s);for(const t of this.On(s))t.lo(i)}async Dh(t){const s=t.tags,i=t.pos;await this.jn(s);for(const t of this.On(s))t.uo(i)}async Fh(t){const s=t.originalUrl,i=t.url,e=t.type,h=t.isMusic;try{await this.Fn(s,i,e,"",h)}catch(t){console.error("[Construct] Audio: error preloading: ",t)}}async Lh(t){const s=t.url,i=t.type,e=t.isMusic,h=await this.Jh("",s,i,e,!0);if(!h)return;h.et(),this.uh===h&&(this.uh=null);const n=this.je.indexOf(h);-1!==n&&this.je.splice(n,1)}Uh(){for(const t of this.je)t.et(),this.uh===t&&(this.uh=null);this.je.length=0}Wh(t){const s=t.isSuspended;!s&&this.We.resume&&this.We.resume();for(const t of this.$e)t.do(s);s&&this.We.suspend&&this.We.suspend()}Nh(t){if(this.Qe=t.timeScale,this.th=t.gameTime,this.Xe=t.tickCount,0!==this.Ze)for(const t of this.$e)t.wo();const s=t.listenerPos;!s||this.oh[0]===s[0]&&this.oh[1]===s[1]&&this.oh[2]===s[2]||(this.oh[0]=s[0],this.oh[1]=s[1],this.oh[2]=s[2],this.We.listener.setPosition(s[0],s[1],s[2]));const i=t.listenerOrientation;if(i&&(this.rh[0]!==i[0]||this.rh[1]!==i[1]||this.rh[2]!==i[2]||this.rh[3]!==i[3]||this.rh[4]!==i[4]||this.rh[5]!==i[5])){for(let t=0;t<6;++t)this.rh[t]=i[t];this.We.listener.setOrientation(...this.rh)}for(const s of t.instPans){const t=s.uid;for(const i of this.$e)i.fo()===t&&i.po(s.x,s.y,s.z,s.angle)}}async Hh(t){const s=t.type,i=t.hasOwnProperty("tags")?t.tags:[t.tag],e=t.params;let h,n;if("convolution"===s)try{n=await this.Jh(t.bufferOriginalUrl,t.bufferUrl,t.bufferType,!1)}catch(t){return void console.log("[Construct] Audio: error loading convolution: ",t)}for(const o of i){if("filter"===s)h=new self.mo(this,...e);else if("delay"===s)h=new self.yo(this,...e);else if("convolution"===s)h=new self.vo(this,n.bo(),...e),h.So(t.bufferOriginalUrl,t.bufferUrl,t.bufferType);else if("flanger"===s)h=new self._o(this,...e);else if("phaser"===s)h=new self.ko(this,...e);else if("gain"===s)h=new self.Po(this,...e);else if("stereopan"===s)h=new self.xo(this,...e);else if("tremolo"===s)h=new self.Mo(this,...e);else if("ringmod"===s)h=new self.Oo(this,...e);else if("distortion"===s)h=new self.Ro(this,...e);else if("compressor"===s)h=new self.To(this,...e);else{if("analyser"!==s)throw new Error("invalid effect type");h=new self.Co(this,...e)}this.hn(o,h)}this.Go()}Vh(t){const s=t.tags,i=t.index,e=t.param,h=t.value,n=t.ramp,o=t.time;for(const t of s){const s=this.dh.get(t.toLowerCase());!s||i<0||i>=s.length||s[i].Io(e,h,n,o)}this.Go()}Bh(t){const s=t.tags;for(const t of s){const s=t.toLowerCase(),i=this.dh.get(s);if(!i||!i.length)return;for(const t of i)t.et();this.dh.delete(s),this.an(s)}}Eo(t){this.wh.add(t),this.$n()}Ao(t){this.wh.delete(t)}Go(){this.fh||(this.fh=!0,Promise.resolve().then(()=>this.Do()))}Do(){const t={};for(const[s,i]of this.dh)t[s]=i.map(t=>t.qn());this.S("fxstate",{fxstate:t}),this.fh=!1}async jh(t){const s=t.saveLoadMode;if(3!==s){const t=[];for(const i of this.$e)i.Mn()&&1===s||!i.Mn()&&2===s?t.push(i):i.et();this.$e=t}for(const t of this.dh.values())for(const s of t)s.et();this.dh.clear(),this.Qe=t.timeScale,this.th=t.gameTime;const i=t.listenerPos;this.oh[0]=i[0],this.oh[1]=i[1],this.oh[2]=i[2],this.We.listener.setPosition(i[0],i[1],i[2]);const e=t.listenerOrientation;if(Array.isArray(e)){for(let t=0;t<6;++t)this.rh[t]=e[t];this.We.listener.setOrientation(...this.rh)}this.ue=t.isSilent,this.h.li(this.ue),this.Ke=t.masterVolume,this.He.gain.value=this.Ke;const h=[];for(const s of Object.values(t.effects))h.push(Promise.all(s.map(t=>this.Hh(t))));await Promise.all(h),await Promise.all(t.playing.map(t=>this.Fo(t,s))),this.$n()}async Fo(t,s){if(3===s)return;const i=t.bufferOriginalUrl,e=t.bufferUrl,h=t.bufferType,n=t.isMusic,o=t.tags,r=t.isLooping,a=t.volume,c=t.playbackTime;if(n&&1===s)return;if(!n&&2===s)return;let l=null;try{l=await this.Fn(i,e,h,o,n)}catch(t){return void console.error("[Construct] Audio: error loading audio state: ",t)}l.Lo(t.pan),l.Uo(t.stereoPan),l.Play(r,a,c,0),t.isPlaying||l.eo(),l.Wo(t)}yh(t,s){this.gh&&this.gh.disconnect(),this.mh=s.toLowerCase(),this.gh=this.We.createMediaStreamSource(t),this.gh.connect(this.sn(this.mh))}Sh(){return this.bh||(this.bh=this.We.createMediaStreamDestination(),this.He.connect(this.bh)),this.bh.stream}async $h(t){try{const s=t.time,i=this.We.suspend(s);this.ph?this.We.resume():(this.We.startRendering().then(t=>this.Ho(t)).catch(t=>this.Vo(t)),this.ph=!0),await i}catch(t){this.Vo(t)}}zh(){this.We.resume()}Ho(t){const s=[];for(let i=0,e=t.numberOfChannels;i<e;++i){const e=t.getChannelData(i);s.push(e.buffer)}this.h._("runtime","offline-audio-render-completed",{duration:t.duration,length:t.length,numberOfChannels:t.numberOfChannels,sampleRate:t.sampleRate,channelData:s},null,s)}Vo(t){console.error("[Audio] Offline rendering error: ",t)}static Zh(t,s){return t===s||t.normalize().toLowerCase()===s.normalize().toLowerCase()}static Bo(t){return t*L}static No(t){return Math.pow(10,t/20)}static jo(t){return Math.max(Math.min(self.Ue.No(t),1),0)}static $o(t){return Math.log(t)/Math.log(10)*20}static zo(t){return self.Ue.$o(Math.max(Math.min(t,1),0))}static qo(t,s){return 1-Math.exp(-s*t)}},self.ss.ei(self.Ue)}self.An=class{constructor(t,s,i,e,h){this.Yo=t,this.Xo=s,this.Jo=i,this.Ko=e,this.Zo=h,this.Qo="",this.tr="not-loaded",this.sr=null}et(){this.tr="not-loaded",this.Yo=null,this.sr=null}Wn(){return!this.Yo}static En(t,s,i,e,h){return!h||t.gn()?new self.ir(t,s,i,e,h):new self.er(t,s,i,e,h)}Hn(t){return"html5"===this.Qo?new self.hr(this.Yo,this,t):new self.nr(this.Yo,this,t)}rr(){}In(){return this.sr||(this.sr=this.rr()),this.sr}ar(){}cr(){}lr(){return"failed"===this.tr}Qh(){return this.Yo.Qh()}ur(){return this.Qo}dr(){return this.Xo}Gn(){return this.Jo}wr(){return this.Ko}Mn(){return this.Zo}Dn(){}},self.er=class extends self.An{constructor(t,s,i,e,h){super(t,s,i,e,h),this.Qo="html5",this.pr=new Audio,this.pr.crossOrigin="anonymous",this.pr.autoplay=!1,this.pr.preload="auto",this.mr=null,this.gr=null,this.yr=!1,this.pr.addEventListener("canplaythrough",()=>this.yr=!0),this.vr=this.Qh().createGain(),this.br=null,this.pr.addEventListener("canplay",()=>{this.mr&&(this.tr="loaded",this.mr(),this.mr=null,this.gr=null),!this.br&&this.pr&&(this.br=this.Qh().createMediaElementSource(this.pr),this.br.connect(this.vr))}),this.onended=null,this.pr.addEventListener("ended",()=>{this.onended&&this.onended()}),this.pr.addEventListener("error",t=>this.Sr(t))}et(){this.Yo.kn(this),this.vr.disconnect(),this.vr=null,this.br.disconnect(),this.br=null,this.pr&&!this.pr.paused&&this.pr.pause(),this.onended=null,this.pr=null,super.et()}rr(){return this.tr="loading",new Promise((t,s)=>{this.mr=t,this.gr=s,this.pr.src=this.Jo})}Sr(t){console.error(`[Construct] Audio '${this.Jo}' error: `,t),this.gr&&(this.tr="failed",this.gr(t),this.mr=null,this.gr=null)}ar(){const t=this.pr.readyState>=4;return t&&(this.yr=!0),t||this.yr}cr(){return this.ar()}_r(){return this.pr}kr(){return this.vr}Dn(){return this.pr.duration}},self.ir=class extends self.An{constructor(t,s,i,e,h){super(t,s,i,e,h),this.Qo="webaudio",this.Pr=null,this.Mr=null}et(){this.Yo.kn(this),this.Pr=null,this.Mr=null,super.et()}async Or(){if(this.Pr)return this.Pr;const t=this.Yo.A();if("playable-ad-single-file"===t.gs()&&t.mi(this.Jo)){const s=t._PlayableAdFetchBlob(this.Jo);this.Pr=await s.arrayBuffer()}else{const t=await fetch(this.Jo);if(!t.ok)throw new Error(`error fetching audio data: ${t.status} ${t.statusText}`);this.Pr=await t.arrayBuffer()}}async Rr(){if(this.Mr)return this.Mr;const t=this.Yo.Qh();this.Mr=await t.decodeAudioData(this.Pr),this.Pr=null}async rr(){try{if(this.tr="loading",await this.Or(),this.Wn())return;await this.Rr(),this.tr="loaded"}catch(t){this.tr="failed",console.error(`[Construct] Failed to load audio '${this.Jo}': `,t)}}ar(){return!(!this.Pr&&!this.Mr)}cr(){return!!this.Mr}bo(){return this.Mr}Dn(){return this.Mr?this.Mr.duration:0}};{let W=0;self.Tr=class{constructor(t,s,i){this.Yo=t,this.Cr=s,this.Gr=i,this.Ir=this.Cn(),this.Er=W++,this.Ar=this.Qh().createGain(),this.Ar.connect(this.tn()),this.Dr=null,this.Fr=!1,this.Lr=[0,0,0],this.Ur=[0,0,0],this.Wr=[0,0,0],this.Hr=null,this.Vr=!1,this.Br=0,this.Nr=!0,this.jr=!1,this.$r=!1,this.zr=!1,this.qr=1,this.Yr=!1,this.Xr=1;const e=this.Yo.fn();this.Jr=1===e&&!this.Mn()||2===e,this.Kr=-1,this.Zr=-1,this.Qr=!1}et(){this.Yo=null,this.Cr=null,this.Dr&&(this.Dr.disconnect(),this.Dr=null),this.Hr&&(this.Hr.disconnect(),this.Hr=null),this.Ar.disconnect(),this.Ar=null}Qh(){return this.Yo.Qh()}Un(t){this.Gr=t;const s=this.Cn();this.Ir!==s&&(this.Ir=s,this.un(this.tn()))}Rn(){return this.Gr}Cn(){return this.Gr.length>0?this.Gr[0]:""}tn(){return this.Yo.sn(this.Cn())}ta(){return this.Jr?this.Yo.mn():performance.now()/1e3}dr(){return this.Cr.dr()}Gn(){return this.Cr.Gn()}wr(){return this.Cr.wr()}Pn(){return this.Cr}Mn(){return this.Cr.Mn()}sa(){return this.Er}Tn(){}Ln(){}IsPlaying(){return!this.Nr&&!this.jr&&!this.Tn()}zn(){return!this.Nr&&!this.Tn()}ia(){}Dn(t){let s=this.Cr.Dn();return t&&(s/=this.Xr||.001),s}Play(t,s,i,e){}io(){}eo(){}ea(){return this.jr}ho(){}no(t){this.qr=t,this.Ar.gain.cancelScheduledValues(0),this.Zr=-1,this.Ar.gain.value=this.ha()}oo(t,s,i){if(this.na())return;const e=this.Ar.gain;e.cancelScheduledValues(0);const h=this.Yo.Xh(),n=h+s;e.setValueAtTime(e.value,h),e.linearRampToValueAtTime(t,n),this.qr=t,this.Zr=n,this.Qr=i}oa(){this.no(this.qr)}m(t){-1!==this.Zr&&t>=this.Zr&&(this.Zr=-1,this.Qr&&this.io(),this.Yo.Xn("fade-ended",this.Gr,this.Er))}ha(){const t=this.qr;return isFinite(t)?t:0}ro(t){t=!!t,this.Yr!==t&&(this.Yr=t,this.ao())}na(){return this.Yr}wn(){return this.Yo.wn()}ao(){}co(t){}ra(){return this.zr}lo(t){this.Xr!==t&&(this.Xr=t,this.wo())}wo(){}aa(){return this.Xr}uo(t){}do(t){}Jn(t){t=!!t,this.Fr!==t&&(this.Fr=t,this.Fr?(this.Qn(!1),this.Dr||(this.Dr=this.Qh().createPanner(),this.Dr.panningModel=this.Yo.yn(),this.Dr.distanceModel=this.Yo.vn(),this.Dr.refDistance=this.Yo.bn(),this.Dr.maxDistance=this.Yo.Sn(),this.Dr.rolloffFactor=this.Yo._n()),this.Ar.disconnect(),this.Ar.connect(this.Dr),this.Dr.connect(this.tn())):(this.Dr.disconnect(),this.Ar.disconnect(),this.Ar.connect(this.tn())))}Kn(t,s,i,e,h,n,o){if(!this.Fr)return;this.po(t,s,i,e);const r=self.Ue.Bo;this.Wr[0]!==r(h)&&(this.Wr[0]=r(h),this.Dr.coneInnerAngle=r(h)),this.Wr[1]!==r(n)&&(this.Wr[1]=r(n),this.Dr.coneOuterAngle=r(n)),this.Wr[2]!==o&&(this.Wr[2]=o,this.Dr.coneOuterGain=o)}po(t,s,i,e){if(!this.Fr)return;const h=this.Lr,n=this.Ur,o=Math.cos(e),r=Math.sin(e);h[0]===t&&h[1]===s&&h[2]===i||(h[0]=t,h[1]=s,h[2]=i,this.Dr.setPosition(...h)),n[0]===o&&n[1]===r&&0===n[2]||(n[0]=o,n[1]=r,n[2]=0,this.Dr.setOrientation(...n))}Qn(t){t=!!t,this.Vr!==t&&(this.Vr=t,this.Vr?(this.Jn(!1),this.Hr=this.Qh().createStereoPanner(),this.Ar.disconnect(),this.Ar.connect(this.Hr),this.Hr.connect(this.tn())):(this.Hr.disconnect(),this.Hr=null,this.Ar.disconnect(),this.Ar.connect(this.tn())))}so(t){this.Vr&&this.Br!==t&&(this.Hr.pan.value=t,this.Br=t)}Zn(t){this.Kr=t}fo(){return this.Kr}ca(){}un(t){const s=this.Hr||this.Dr||this.Ar;s.disconnect(),s.connect(t)}qn(){return{aiid:this.sa(),tags:this.Gr,duration:this.Dn(),volume:-1===this.Zr?this.qr:this.Ar.gain.value,isPlaying:this.IsPlaying(),playbackTime:this.ia(),playbackRate:this.aa(),uid:this.Kr,bufferOriginalUrl:this.dr(),bufferUrl:"",bufferType:this.wr(),isMusic:this.Mn(),isLooping:this.ra(),isMuted:this.na(),resumePosition:this.ca(),pan:this.la(),stereoPan:this.ua()}}Wo(t){this.lo(t.playbackRate),this.ro(t.isMuted)}la(){if(!this.Dr)return null;const t=this.Dr;return{pos:this.Lr,orient:this.Ur,cia:t.coneInnerAngle,coa:t.coneOuterAngle,cog:t.coneOuterGain,uid:this.Kr}}Lo(t){if(!t)return void this.Jn(!1);this.Jn(!0);const s=this.Dr,i=t.pos;this.Lr[0]=i[0],this.Lr[1]=i[1],this.Lr[2]=i[2];const e=t.orient;this.Ur[0]=e[0],this.Ur[1]=e[1],this.Ur[2]=e[2],s.setPosition(...this.Lr),s.setOrientation(...this.Ur),this.Wr[0]=t.cia,this.Wr[1]=t.coa,this.Wr[2]=t.cog,s.coneInnerAngle=t.cia,s.coneOuterAngle=t.coa,s.coneOuterGain=t.cog,this.Kr=t.uid}ua(){return this.Hr?this.Br:null}Uo(t){"number"==typeof t?(this.Qn(!0),this.so(t)):this.Qn(!1)}}}self.hr=class extends self.Tr{constructor(t,s,i){super(t,s,i),this.Cr.kr().connect(this.Ar),this.Cr.onended=()=>this.da()}et(){this.io(),this.Cr.kr().disconnect(),super.et()}_r(){return this.Cr._r()}da(){this.Nr=!0,this.Kr=-1,this.Yo.Xn("ended",this.Gr,this.Er)}Tn(){return this._r().ended}Ln(){return!!this.Nr||this.Tn()}ia(){let t=this._r().currentTime;return this.zr||(t=Math.min(t,this.Dn())),t}Play(t,s,i,e){const h=this._r();if(1!==h.playbackRate&&(h.playbackRate=1),h.loop!==t&&(h.loop=t),this.no(s),this.Yr=!1,h.muted&&(h.muted=!1),h.currentTime!==i)try{h.currentTime=i}catch(t){console.warn(`[Construct] Exception seeking audio '${this.Cr.Gn()}' to position '${i}': `,t)}this.Yo.ri(h),this.Nr=!1,this.jr=!1,this.zr=t,this.Xr=1}io(){const t=this._r();t.paused||t.pause(),this.Yo.ai(t),this.Nr=!0,this.jr=!1,this.Kr=-1}eo(){if(this.jr||this.Nr||this.Tn())return;const t=this._r();t.paused||t.pause(),this.Yo.ai(t),this.jr=!0}ho(){!this.jr||this.Nr||this.Tn()||(this.Yo.ri(this._r()),this.jr=!1)}ao(){this._r().muted=this.Yr||this.wn()}co(t){t=!!t,this.zr!==t&&(this.zr=t,this._r().loop=t)}wo(){let t=this.Xr;this.Jr&&(t*=this.Yo.pn());try{this._r().playbackRate=t}catch(s){console.warn(`[Construct] Unable to set playback rate '${t}':`,s)}}uo(t){if(!this.Nr&&!this.Tn())try{this._r().currentTime=t}catch(s){console.warn(`[Construct] Error seeking audio to '${t}': `,s)}}ca(){return this.ia()}do(t){t?this.IsPlaying()?(this._r().pause(),this.$r=!0):this.$r=!1:this.$r&&(this.Yo.ri(this._r()),this.$r=!1)}},self.nr=class extends self.Tr{constructor(t,s,i){super(t,s,i),this.wa=null,this.fa=t=>this.da(t),this.pa=!0,this.ma=null,this.ga=0,this.ya=0,this.va=0,this.ba=1}et(){this.io(),this.Sa(),this.fa=null,super.et()}Sa(){this.wa&&(this.wa.onended=null,this.wa.disconnect(),this.wa.buffer=null),this.wa=null,this.ma=null}da(t){this.jr||this.$r||t.target===this.ma&&(this.pa=!0,this.Nr=!0,this.Kr=-1,this.Sa(),this.Yo.Xn("ended",this.Gr,this.Er))}Tn(){return!(!this.Nr&&this.wa&&this.wa.loop)&&!this.jr&&this.pa}Ln(){return!(this.wa&&!this.Nr)||this.Tn()}ia(){let t=0;return t=this.jr?this.va:this.ya+(this.ta()-this.ga)*this.Xr,this.zr||(t=Math.min(t,this.Dn())),t}Play(t,s,i,e){this.Yr=!1,this.ba=1,this.no(s),this.Sa(),this.wa=this.Qh().createBufferSource(),this.wa.buffer=this.Cr.bo(),this.wa.connect(this.Ar),this.ma=this.wa,this.wa.onended=this.fa,this.wa.loop=t,this.wa.start(e,i),this.pa=!1,this.Nr=!1,this.jr=!1,this.zr=t,this.Xr=1,this.ga=this.ta(),this.ya=i}io(){if(this.wa)try{this.wa.stop(0)}catch(t){}this.Nr=!0,this.jr=!1,this.Kr=-1}eo(){this.jr||this.Nr||this.Tn()||(this.va=this.ia(),this.zr&&(this.va%=this.Dn()),this.jr=!0,this.wa.stop(0))}ho(){!this.jr||this.Nr||this.Tn()||(this.Sa(),this.wa=this.Qh().createBufferSource(),this.wa.buffer=this.Cr.bo(),this.wa.connect(this.Ar),this.ma=this.wa,this.wa.onended=this.fa,this.wa.loop=this.zr,this.oa(),this.wo(),this.wa.start(0,this.va),this.ga=this.ta(),this.ya=this.va,this.jr=!1)}ha(){return super.ha()*this.ba}ao(){this.ba=this.Yr||this.wn()?0:1,this.oa()}co(t){t=!!t,this.zr!==t&&(this.zr=t,this.wa&&(this.wa.loop=t))}wo(){let t=this.Xr;this.Jr&&(t*=this.Yo.pn()),this.wa&&(this.wa.playbackRate.value=t)}uo(t){this.Nr||this.Tn()||(this.jr?this.va=t:(this.eo(),this.va=t,this.ho()))}ca(){return this.va}do(t){t?this.IsPlaying()?(this.$r=!0,this.va=this.ia(),this.zr&&(this.va%=this.Dn()),this.wa.stop(0)):this.$r=!1:this.$r&&(this.Sa(),this.wa=this.Qh().createBufferSource(),this.wa.buffer=this.Cr.bo(),this.wa.connect(this.Ar),this.ma=this.wa,this.wa.onended=this.fa,this.wa.loop=this.zr,this.oa(),this.wo(),this.wa.start(0,this.va),this.ga=this.ta(),this.ya=this.va,this.$r=!1)}Wo(t){super.Wo(t),this.va=t.resumePosition}};{class H{constructor(t){this.Yo=t,this.We=t.Qh(),this._a=-1,this.ka="",this.Ko="",this.Pa=null}et(){this.We=null}nn(t){this._a=t}xa(){return this._a}rn(t){this.ka=t}Ma(){return this.ka}Oa(){return this.We.createGain()}en(){}cn(t){}Ra(t,s,i,e){if(t.cancelScheduledValues(0),0===e)return void(t.value=s);const h=this.We.currentTime;switch(e+=h,i){case 0:t.setValueAtTime(s,e);break;case 1:t.setValueAtTime(t.value,h),t.linearRampToValueAtTime(s,e);break;case 2:t.setValueAtTime(t.value,h),t.exponentialRampToValueAtTime(s,e)}}qn(){return{type:this.Ko,tag:this.ka,params:this.Pa}}}self.mo=class extends H{constructor(t,s,i,e,h,n,o){super(t),this.Ko="filter",this.Pa=[s,i,e,h,n,o],this.Ta=this.Oa(),this.Ca=this.Oa(),this.Ca.gain.value=o,this.Ga=this.Oa(),this.Ga.gain.value=1-o,this.Ia=this.We.createBiquadFilter(),this.Ia.type=s,this.Ia.frequency.value=i,this.Ia.detune.value=e,this.Ia.Q.value=h,this.Ia.gain.vlaue=n,this.Ta.connect(this.Ia),this.Ta.connect(this.Ga),this.Ia.connect(this.Ca)}et(){this.Ta.disconnect(),this.Ia.disconnect(),this.Ca.disconnect(),this.Ga.disconnect(),super.et()}cn(t){this.Ca.disconnect(),this.Ca.connect(t),this.Ga.disconnect(),this.Ga.connect(t)}en(){return this.Ta}Io(t,s,i,e){switch(t){case 0:s=Math.max(Math.min(s/100,1),0),this.Pa[5]=s,this.Ra(this.Ca.gain,s,i,e),this.Ra(this.Ga.gain,1-s,i,e);break;case 1:this.Pa[1]=s,this.Ra(this.Ia.frequency,s,i,e);break;case 2:this.Pa[2]=s,this.Ra(this.Ia.detune,s,i,e);break;case 3:this.Pa[3]=s,this.Ra(this.Ia.Q,s,i,e);break;case 4:this.Pa[4]=s,this.Ra(this.Ia.gain,s,i,e)}}},self.yo=class extends H{constructor(t,s,i,e){super(t),this.Ko="delay",this.Pa=[s,i,e],this.Ta=this.Oa(),this.Ca=this.Oa(),this.Ca.gain.value=e,this.Ga=this.Oa(),this.Ga.gain.value=1-e,this.Ea=this.Oa(),this.Aa=this.We.createDelay(s),this.Aa.delayTime.value=s,this.Da=this.Oa(),this.Da.gain.value=i,this.Ta.connect(this.Ea),this.Ta.connect(this.Ga),this.Ea.connect(this.Ca),this.Ea.connect(this.Aa),this.Aa.connect(this.Da),this.Da.connect(this.Ea)}et(){this.Ta.disconnect(),this.Ca.disconnect(),this.Ga.disconnect(),this.Ea.disconnect(),this.Aa.disconnect(),this.Da.disconnect(),super.et()}cn(t){this.Ca.disconnect(),this.Ca.connect(t),this.Ga.disconnect(),this.Ga.connect(t)}en(){return this.Ta}Io(t,s,i,e){const h=self.Ue.jo;switch(t){case 0:s=Math.max(Math.min(s/100,1),0),this.Pa[2]=s,this.Ra(this.Ca.gain,s,i,e),this.Ra(this.Ga.gain,1-s,i,e);break;case 4:this.Pa[1]=h(s),this.Ra(this.Da.gain,h(s),i,e);break;case 5:this.Pa[0]=s,this.Ra(this.Aa.delayTime,s,i,e)}}},self.vo=class extends H{constructor(t,s,i,e){super(t),this.Ko="convolution",this.Pa=[i,e],this.Fa="",this.La="",this.Ua="",this.Ta=this.Oa(),this.Ca=this.Oa(),this.Ca.gain.value=e,this.Ga=this.Oa(),this.Ga.gain.value=1-e,this.Wa=this.We.createConvolver(),this.Wa.normalize=i,this.Wa.buffer=s,this.Ta.connect(this.Wa),this.Ta.connect(this.Ga),this.Wa.connect(this.Ca)}et(){this.Ta.disconnect(),this.Wa.disconnect(),this.Ca.disconnect(),this.Ga.disconnect(),super.et()}cn(t){this.Ca.disconnect(),this.Ca.connect(t),this.Ga.disconnect(),this.Ga.connect(t)}en(){return this.Ta}Io(t,s,i,e){0===t&&(s=Math.max(Math.min(s/100,1),0),this.Pa[1]=s,this.Ra(this.Ca.gain,s,i,e),this.Ra(this.Ga.gain,1-s,i,e))}So(t,s,i){this.Fa=t,this.La=s,this.Ua=i}qn(){const t=super.qn();return t.bufferOriginalUrl=this.Fa,t.bufferUrl="",t.bufferType=this.Ua,t}},self._o=class extends H{constructor(t,s,i,e,h,n){super(t),this.Ko="flanger",this.Pa=[s,i,e,h,n],this.Ta=this.Oa(),this.Ga=this.Oa(),this.Ga.gain.value=1-n/2,this.Ca=this.Oa(),this.Ca.gain.value=n/2,this.Ha=this.Oa(),this.Ha.gain.value=h,this.Aa=this.We.createDelay(s+i),this.Aa.delayTime.value=s,this.Va=this.We.createOscillator(),this.Va.frequency.value=e,this.Ba=this.Oa(),this.Ba.gain.value=i,this.Ta.connect(this.Aa),this.Ta.connect(this.Ga),this.Aa.connect(this.Ca),this.Aa.connect(this.Ha),this.Ha.connect(this.Aa),this.Va.connect(this.Ba),this.Ba.connect(this.Aa.delayTime),this.Va.start(0)}et(){this.Va.stop(0),this.Ta.disconnect(),this.Aa.disconnect(),this.Va.disconnect(),this.Ba.disconnect(),this.Ga.disconnect(),this.Ca.disconnect(),this.Ha.disconnect(),super.et()}cn(t){this.Ca.disconnect(),this.Ca.connect(t),this.Ga.disconnect(),this.Ga.connect(t)}en(){return this.Ta}Io(t,s,i,e){switch(t){case 0:s=Math.max(Math.min(s/100,1),0),this.Pa[4]=s,this.Ra(this.Ca.gain,s/2,i,e),this.Ra(this.Ga.gain,1-s/2,i,e);break;case 6:this.Pa[1]=s/1e3,this.Ra(this.Ba.gain,s/1e3,i,e);break;case 7:this.Pa[2]=s,this.Ra(this.Va.frequency,s,i,e);break;case 8:this.Pa[3]=s/100,this.Ra(this.Ha.gain,s/100,i,e)}}},self.ko=class extends H{constructor(t,s,i,e,h,n,o){super(t),this.Ko="phaser",this.Pa=[s,i,e,h,n,o],this.Ta=this.Oa(),this.Ga=this.Oa(),this.Ga.gain.value=1-o/2,this.Ca=this.Oa(),this.Ca.gain.value=o/2,this.Ia=this.We.createBiquadFilter(),this.Ia.type="allpass",this.Ia.frequency.value=s,this.Ia.detune.value=i,this.Ia.Q.value=e,this.Va=this.We.createOscillator(),this.Va.frequency.value=n,this.Ba=this.Oa(),this.Ba.gain.value=h,this.Ta.connect(this.Ia),this.Ta.connect(this.Ga),this.Ia.connect(this.Ca),this.Va.connect(this.Ba),this.Ba.connect(this.Ia.frequency),this.Va.start(0)}et(){this.Va.stop(0),this.Ta.disconnect(),this.Ia.disconnect(),this.Va.disconnect(),this.Ba.disconnect(),this.Ga.disconnect(),this.Ca.disconnect(),super.et()}cn(t){this.Ca.disconnect(),this.Ca.connect(t),this.Ga.disconnect(),this.Ga.connect(t)}en(){return this.Ta}Io(t,s,i,e){switch(t){case 0:s=Math.max(Math.min(s/100,1),0),this.Pa[5]=s,this.Ra(this.Ca.gain,s/2,i,e),this.Ra(this.Ga.gain,1-s/2,i,e);break;case 1:this.Pa[0]=s,this.Ra(this.Ia.frequency,s,i,e);break;case 2:this.Pa[1]=s,this.Ra(this.Ia.detune,s,i,e);break;case 3:this.Pa[2]=s,this.Ra(this.Ia.Q,s,i,e);break;case 6:this.Pa[3]=s,this.Ra(this.Ba.gain,s,i,e);break;case 7:this.Pa[4]=s,this.Ra(this.Va.frequency,s,i,e)}}},self.Po=class extends H{constructor(t,s){super(t),this.Ko="gain",this.Pa=[s],this.Na=this.Oa(),this.Na.gain.value=s}et(){this.Na.disconnect(),super.et()}cn(t){this.Na.disconnect(),this.Na.connect(t)}en(){return this.Na}Io(t,s,i,e){const h=self.Ue.jo;4===t&&(this.Pa[0]=h(s),this.Ra(this.Na.gain,h(s),i,e))}},self.xo=class extends H{constructor(t,s){super(t),this.Ko="stereopan",this.Pa=[s],this.Na=this.We.createStereoPanner(),this.Na.pan.value=s}et(){this.Na.disconnect(),super.et()}cn(t){this.Na.disconnect(),this.Na.connect(t)}en(){return this.Na}Io(t,s,i,e){s=Math.min(Math.max(s/100,-1),1),9===t&&(this.Pa[0]=s,this.Ra(this.Na.pan,s,i,e))}},self.Mo=class extends H{constructor(t,s,i){super(t),this.Ko="tremolo",this.Pa=[s,i],this.Na=this.Oa(),this.Na.gain.value=1-i/2,this.Va=this.We.createOscillator(),this.Va.frequency.value=s,this.Ba=this.Oa(),this.Ba.gain.value=i/2,this.Va.connect(this.Ba),this.Ba.connect(this.Na.gain),this.Va.start(0)}et(){this.Va.stop(0),this.Va.disconnect(),this.Ba.disconnect(),this.Na.disconnect(),super.et()}cn(t){this.Na.disconnect(),this.Na.connect(t)}en(){return this.Na}Io(t,s,i,e){switch(t){case 0:s=Math.max(Math.min(s/100,1),0),this.Pa[1]=s,this.Ra(this.Na.gain,1-s/2,i,e),this.Ra(this.Ba.gain,s/2,i,e);break;case 7:this.Pa[0]=s,this.Ra(this.Va.frequency,s,i,e)}}},self.Oo=class extends H{constructor(t,s,i){super(t),this.Ko="ringmod",this.Pa=[s,i],this.Ta=this.Oa(),this.Ca=this.Oa(),this.Ca.gain.value=i,this.Ga=this.Oa(),this.Ga.gain.value=1-i,this.ja=this.Oa(),this.ja.gain.value=0,this.Va=this.We.createOscillator(),this.Va.frequency.value=s,this.Va.connect(this.ja.gain),this.Va.start(0),this.Ta.connect(this.ja),this.Ta.connect(this.Ga),this.ja.connect(this.Ca)}et(){this.Va.stop(0),this.Va.disconnect(),this.ja.disconnect(),this.Ta.disconnect(),this.Ca.disconnect(),this.Ga.disconnect(),super.et()}cn(t){this.Ca.disconnect(),this.Ca.connect(t),this.Ga.disconnect(),this.Ga.connect(t)}en(){return this.Ta}Io(t,s,i,e){switch(t){case 0:s=Math.max(Math.min(s/100,1),0),this.Pa[1]=s,this.Ra(this.Ca.gain,s,i,e),this.Ra(this.Ga.gain,1-s,i,e);break;case 7:this.Pa[0]=s,this.Ra(this.Va.frequency,s,i,e)}}},self.Ro=class extends H{constructor(t,s,i,e,h,n){super(t),this.Ko="distortion",this.Pa=[s,i,e,h,n],this.Ta=this.Oa(),this.$a=this.Oa(),this.za=this.Oa(),this.qa(e,h),this.Ca=this.Oa(),this.Ca.gain.value=n,this.Ga=this.Oa(),this.Ga.gain.value=1-n,this.Ya=this.We.createWaveShaper(),this.Xa=new Float32Array(65536),this.Ja(s,i),this.Ya.curve=this.Xa,this.Ta.connect(this.$a),this.Ta.connect(this.Ga),this.$a.connect(this.Ya),this.Ya.connect(this.za),this.za.connect(this.Ca)}et(){this.Ta.disconnect(),this.$a.disconnect(),this.Ya.disconnect(),this.za.disconnect(),this.Ca.disconnect(),this.Ga.disconnect(),super.et()}qa(t,s){t<.01&&(t=.01),this.$a.gain.value=t,this.za.gain.value=Math.pow(1/t,.6)*s}Ja(t,s){const i=32768;for(let e=0;e<i;++e){let h=e/i;h=this.Ka(h,t,s),this.Xa[i+e]=h,this.Xa[i-e-1]=-h}}Ka(t,s,i){const e=1.05*i*s-s,h=t<0?-1:1,n=t<0?-t:t;let o=n<s?n:s+e*self.Ue.qo(n-s,1/e);return o*=h,o}cn(t){this.Ca.disconnect(),this.Ca.connect(t),this.Ga.disconnect(),this.Ga.connect(t)}en(){return this.Ta}Io(t,s,i,e){0===t&&(s=Math.max(Math.min(s/100,1),0),this.Pa[4]=s,this.Ra(this.Ca.gain,s,i,e),this.Ra(this.Ga.gain,1-s,i,e))}},self.To=class extends H{constructor(t,s,i,e,h,n){super(t),this.Ko="compressor",this.Pa=[s,i,e,h,n],this.Na=this.We.createDynamicsCompressor(),this.Na.threshold.value=s,this.Na.knee.value=i,this.Na.ratio.value=e,this.Na.attack.value=h,this.Na.release.value=n}et(){this.Na.disconnect(),super.et()}cn(t){this.Na.disconnect(),this.Na.connect(t)}en(){return this.Na}Io(t,s,i,e){}},self.Co=class extends H{constructor(t,s,i){super(t),this.Ko="analyser",this.Pa=[s,i],this.Na=this.We.createAnalyser(),this.Na.fftSize=s,this.Na.smoothingTimeConstant=i,this.Za=new Float32Array(this.Na.frequencyBinCount),this.Qa=new Uint8Array(s),this.tc=0,this.sc=0,this.Yo.Eo(this)}et(){this.Yo.Ao(this),this.Na.disconnect(),super.et()}m(){this.Na.getFloatFrequencyData(this.Za),this.Na.getByteTimeDomainData(this.Qa);const t=this.Na.fftSize;this.tc=0;let s=0;for(let i=0;i<t;++i){let t=(this.Qa[i]-128)/128;t<0&&(t=-t),this.tc<t&&(this.tc=t),s+=t*t}const i=self.Ue.zo;this.tc=i(this.tc),this.sc=i(Math.sqrt(s/t))}cn(t){this.Na.disconnect(),this.Na.connect(t)}en(){return this.Na}Io(t,s,i,e){}Yn(){return{tag:this.Ma(),index:this.xa(),peak:this.tc,rms:this.sc,binCount:this.Na.frequencyBinCount,freqBins:this.Za}}}}{const V="gamepad";let B=!1;const N=class extends self.i{constructor(t){super(t,V),this.ec=!1,this.N=-1,this.C("ready",()=>this.hc()),this.C("vibrate-dual-rumble",t=>this.nc(t)),this.C("vibrate-trigger-rumble",t=>this.oc(t)),this.C("reset-vibrate",t=>this.rc(t)),this.C("suspend",()=>this.ac()),this.C("resume",()=>this.cc()),window.addEventListener("gamepadconnected",t=>this.lc(t)),window.addEventListener("gamepaddisconnected",t=>this.uc(t)),window.addEventListener("unload",()=>this.dc())}wc(){try{return Array.from(navigator.getGamepads()).filter(t=>t&&t.connected)}catch(t){return B||(console.warn("[Construct] Failed to access gamepads: ",t),B=!0),[]}}hc(){this.ec=!0;for(const t of this.wc())this.fc(t);this.mc()}mc(){-1===this.N&&(this.N=setInterval(()=>this.yc(),4))}vc(){-1!==this.N&&(clearInterval(this.N),this.N=-1)}ac(){this.vc()}cc(){this.mc()}lc(t){this.ec&&this.fc(t.gamepad)}bc(t){const s=t.vibrationActuator;return s&&s.playEffect&&Array.isArray(s.effects)?s.effects:[]}Sc(t){return{index:t.index,id:t.id,vibrationEffects:this.bc(t)}}fc(t){this.S("gamepad-connected",this.Sc(t))}uc(t){if(!this.ec)return;const s=t.gamepad;this.S("gamepad-disconnected",{index:s.index})}yc(){const t=this.wc();if(!t.length)return;const s=t.map(t=>Object.assign(this.Sc(t),{buttons:t.buttons.map(t=>({pressed:t.pressed,value:t.value})),axes:t.axes}));this.S("input-update",s)}_c(t){for(const s of this.wc())if(s.index===t)return s;return null}async nc(t){const s=this._c(t.index);if(!s)return;const i=s.vibrationActuator;if(i&&i.playEffect)try{await i.playEffect("dual-rumble",{duration:t.duration,startDelay:0,weakMagnitude:t.weakMag,strongMagnitude:t.strongMag})}catch(t){console.warn("[Gamepad] Failed to vibrate gamepad (dual rumble): ",t)}}async oc(t){const s=this._c(t.index);if(!s)return;const i=s.vibrationActuator;if(i&&i.playEffect)try{await i.playEffect("trigger-rumble",{duration:t.duration,startDelay:0,weakMagnitude:t.weakMag,strongMagnitude:t.strongMag,leftTrigger:t.leftMag,rightTrigger:t.rightMag})}catch(t){console.warn("[Gamepad] Failed to vibrate gamepad (trigger rumble): ",t)}}rc(t){const s=this._c(t.index);if(!s)return;const i=s.vibrationActuator;i&&i.reset&&i.reset()}dc(){for(const t of this.wc()){const s=t.vibrationActuator;s&&s.reset&&s.reset()}}};self.ss.ei(N)}{const j="keyboard",$=class extends self.i{constructor(t){super(t,j),this.kc=!(!navigator.keyboard||!navigator.keyboard.lock),this.I([["init",()=>this.Pc()],["lock-keyboard",t=>this.xc(t)],["unlock-keyboard",()=>this.Mc()]])}Pc(){return{isKeyboardLockSupported:this.kc}}async xc(t){const s=t.keysArr;try{return 0===s.length?await navigator.keyboard.lock():await navigator.keyboard.lock(s),{isOk:!0}}catch(t){return console.error("Error locking keyboard:",t),{isOk:!1}}}Mc(){try{navigator.keyboard.unlock()}catch(t){console.error("Error unlocking keyboard:",t)}}};self.ss.ei($)}{const z="mouse",q=class extends self.i{constructor(t){super(t,z),this.I([["cursor",t=>this.Oc(t)],["request-pointer-lock",t=>this.Rc(t)],["release-pointer-lock",()=>this.Tc()]]),document.addEventListener("pointerlockchange",t=>this.Cc()),document.addEventListener("pointerlockerror",t=>this.Gc())}Oc(t){document.documentElement.style.cursor=t}Rc(t){this.h.fs().requestPointerLock(t)}Tc(){document.exitPointerLock()}Cc(){this.S("pointer-lock-change",{"has-pointer-lock":!!document.pointerLockElement})}Gc(){this.S("pointer-lock-error",{"has-pointer-lock":!!document.pointerLockElement})}};self.ss.ei(q)}{const Y="touch",X=class extends self.i{constructor(t){super(t,Y),this.C("request-permission",t=>this.Ic(t))}async Ic(t){const s=t.type;let i=!0;0===s?i=await this.Ec():1===s&&(i=await this.Ac()),this.S("permission-result",{type:s,result:i})}async Ec(){if(!self.DeviceOrientationEvent||!self.DeviceOrientationEvent.requestPermission)return!0;try{return"granted"===await self.DeviceOrientationEvent.requestPermission()}catch(t){return console.warn("[Touch] Failed to request orientation permission: ",t),!1}}async Ac(){if(!self.DeviceMotionEvent||!self.DeviceMotionEvent.requestPermission)return!0;try{return"granted"===await self.DeviceMotionEvent.requestPermission()}catch(t){return console.warn("[Touch] Failed to request motion permission: ",t),!1}}};self.ss.ei(X)}if(window.C3_IsSupported){const J=!1;window.c3_runtimeInterface=new self.ss({es:J,Us:"workermain.js",Bs:["scripts/c3main.js"],hs:"scripts/",ns:"playable-ad-zip"})}